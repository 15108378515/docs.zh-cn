---
title: ".NET Core 分发打包"
description: "了解如何为 .NET Core 打包、命名并进行版本控制以进行分发。"
keywords: ".NET, .NET Core, 源, 生成"
author: bleroy
ms.author: mairaw
ms.date: 06/28/2017
ms.topic: article
ms.prod: .net-core
ms.devlang: dotnet
ms.assetid: 71b9d722-c5a8-4271-9ce1-d87e7ae2494d
ms.workload: dotnetcore
ms.openlocfilehash: 9f5cd2f7c4fec553dfdfaf1765663b6896b3061d
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/23/2017
---
# <a name="net-core-distribution-packaging"></a><span data-ttu-id="7963e-104">.NET Core 分发打包</span><span class="sxs-lookup"><span data-stu-id="7963e-104">.NET Core distribution packaging</span></span>

<span data-ttu-id="7963e-105">由于 .NET Core 现已可用于更多平台，因此了解如何为其打包、命名并进行版本控制将很有用。</span><span class="sxs-lookup"><span data-stu-id="7963e-105">As .NET Core becomes available on more and more platforms, it's useful to learn how to package, name, and version it.</span></span> <span data-ttu-id="7963e-106">这样，无论用户选择在哪里运行 .NET，包维护人员均可以帮助确保获得一致的体验。</span><span class="sxs-lookup"><span data-stu-id="7963e-106">This way, package maintainers can help ensure a consistent experience no matter where users choose to run .NET.</span></span>

## <a name="net-core-components"></a><span data-ttu-id="7963e-107">.NET Core 组件</span><span class="sxs-lookup"><span data-stu-id="7963e-107">.NET Core components</span></span>

<span data-ttu-id="7963e-108">.NET Core 由三个需要打包的主要部分构成：</span><span class="sxs-lookup"><span data-stu-id="7963e-108">.NET Core is made of three major parts that need to be packaged:</span></span>

1. <span data-ttu-id="7963e-109">主机也称为“muxer”）有两个不同角色：激活运行时以启动应用程序，及激活 SDK 以向其分派命令。</span><span class="sxs-lookup"><span data-stu-id="7963e-109">**The host** (also known as the "muxer") has two distinct roles: activate a runtime to launch an application, and activate an SDK to dispatch commands to it.</span></span> <span data-ttu-id="7963e-110">主机是本机可执行文件 (`dotnet.exe`)，并是其支持策略库（安装在 `host/fxr` 中）。</span><span class="sxs-lookup"><span data-stu-id="7963e-110">The host is a native executable (`dotnet.exe`) and its supporting policy libraries (installed in `host/fxr`).</span></span> <span data-ttu-id="7963e-111">它由 [`dotnet/core-setup`](https://github.com/dotnet/core-setup/) 存储库中的代码生成。</span><span class="sxs-lookup"><span data-stu-id="7963e-111">It's built from the code in the [`dotnet/core-setup`](https://github.com/dotnet/core-setup/) repository.</span></span> <span data-ttu-id="7963e-112">通常一个给定计算机上只有一个主机，但这并不是一个严格的要求。</span><span class="sxs-lookup"><span data-stu-id="7963e-112">There is typically only one host on a given machine, although that isn't a strict requirement.</span></span>
2. <span data-ttu-id="7963e-113">框架由运行时和支持的托管库构成。</span><span class="sxs-lookup"><span data-stu-id="7963e-113">**The framework** is made of a runtime and supporting managed libraries.</span></span> <span data-ttu-id="7963e-114">可以将框架作为应用程序的一部分进行安装，或者将其作为可供多个应用程序重用的某个中心位置中的共享框架进行安装。</span><span class="sxs-lookup"><span data-stu-id="7963e-114">The framework may be installed as part of an application, or as a shared framework in a central location that can be reused by multiple applications.</span></span> <span data-ttu-id="7963e-115">一个给定计算机上可以安装任意数量的共享框架。</span><span class="sxs-lookup"><span data-stu-id="7963e-115">There may be any number of shared frameworks installed on a given machine.</span></span> <span data-ttu-id="7963e-116">共享框架在 `shared/Microsoft.NETCore.App/<version>` 下运行。</span><span class="sxs-lookup"><span data-stu-id="7963e-116">Shared frameworks live under `shared/Microsoft.NETCore.App/<version>`.</span></span> <span data-ttu-id="7963e-117">主机跨修补程序版本前滚。</span><span class="sxs-lookup"><span data-stu-id="7963e-117">The host rolls forward across patch versions.</span></span> <span data-ttu-id="7963e-118">如果应用程序面向 `Microsoft.NETCore.App` 1.0.0，但仅存在 1.0.4，则将针对 1.0.4 启动此应用。</span><span class="sxs-lookup"><span data-stu-id="7963e-118">If an application targets `Microsoft.NETCore.App` 1.0.0, and only 1.0.4 is present, the app is launched against 1.0.4.</span></span>
3. <span data-ttu-id="7963e-119">SDK（也称为“工具”）是一组托管工具，可用于编写和生成 .NET Core 库和应用程序。</span><span class="sxs-lookup"><span data-stu-id="7963e-119">**The SDK** (also known as "the tooling") is a set of managed tools that can be used to write and build .NET Core libraries and applications.</span></span> <span data-ttu-id="7963e-120">SDK 包括 CLI、MSBuild 及相关生成任务和目标、NuGet、新项目模板等。一个计算机上可以拥有多个 SDK（例如，生成显式要求旧版本的项目时），但是建议使用最新发布的工具。</span><span class="sxs-lookup"><span data-stu-id="7963e-120">The SDK includes the CLI, MSBuild, and associated build tasks and targets, NuGet, new project templates, etc. It's possible to have multiple SDKs on a machine (for example, to build projects that explicitly require an older version), but the recommendation is to use the latest released tools.</span></span>

## <a name="recommended-package-names"></a><span data-ttu-id="7963e-121">建议的包名称</span><span class="sxs-lookup"><span data-stu-id="7963e-121">Recommended package names</span></span>

<span data-ttu-id="7963e-122">下列指南是针对包名称的建议。</span><span class="sxs-lookup"><span data-stu-id="7963e-122">The following guidance is our recommendation for package names.</span></span> <span data-ttu-id="7963e-123">包维护人员可以出于各种原因选择从其中分离，例如他们面向的是特定分发版本的不同传统。</span><span class="sxs-lookup"><span data-stu-id="7963e-123">A package maintainer may choose to diverge from it based on various reasons, such as, a different tradition of the specific distribution they're targeting.</span></span>

### <a name="minimum-package-set"></a><span data-ttu-id="7963e-124">最小包集</span><span class="sxs-lookup"><span data-stu-id="7963e-124">Minimum package set</span></span>

* <span data-ttu-id="7963e-125">`dotnet-runtime-[major].[minor]`：包含指定版本的共享框架（包管理器中应仅提供针对给定的主要/次要组合的最新修补程序版本）。</span><span class="sxs-lookup"><span data-stu-id="7963e-125">`dotnet-runtime-[major].[minor]`: a shared framework with the specified version (only the latest patch version for a given major+minor combination should be available in the package manager).</span></span> <span data-ttu-id="7963e-126">**依赖项**：`dotnet-host`</span><span class="sxs-lookup"><span data-stu-id="7963e-126">**dependencies**: `dotnet-host`</span></span>
* <span data-ttu-id="7963e-127">`dotnet-sdk`：最新的 SDK。</span><span class="sxs-lookup"><span data-stu-id="7963e-127">`dotnet-sdk`: the latest SDK.</span></span> <span data-ttu-id="7963e-128">**依赖项**：最新的 `dotnet-sdk-[major].[minor]`。</span><span class="sxs-lookup"><span data-stu-id="7963e-128">**dependencies**: the latest `dotnet-sdk-[major].[minor]`.</span></span>
* <span data-ttu-id="7963e-129">`dotnet-sdk-[major].[minor]`：包含指定版本的 SDK。</span><span class="sxs-lookup"><span data-stu-id="7963e-129">`dotnet-sdk-[major].[minor]`: the SDK with the specified version.</span></span> <span data-ttu-id="7963e-130">指定的版本是包含的共享框架中最高的包含版本，以便用户可以将 SDK 轻松关联到共享框架。</span><span class="sxs-lookup"><span data-stu-id="7963e-130">The version specified is the highest included version of included shared frameworks, so that users can easily relate an SDK to a shared framework.</span></span> <span data-ttu-id="7963e-131">**依赖项**： `dotnet-host`，一个或多个 `dotnet-runtime-[major].[minor]`（这些运行时之一将供 SDK 代码本身使用，在此处用户针对其他运行时进行生成和运行）。</span><span class="sxs-lookup"><span data-stu-id="7963e-131">**dependencies**: `dotnet-host`, one or more `dotnet-runtime-[major].[minor]` (one of the runtimes is used by the SDK code itself, the others are here for users to build and run against).</span></span>
* <span data-ttu-id="7963e-132">`dotnet-host`：最新的主机。</span><span class="sxs-lookup"><span data-stu-id="7963e-132">`dotnet-host`: the latest host.</span></span>

#### <a name="preview-versions"></a><span data-ttu-id="7963e-133">预览版</span><span class="sxs-lookup"><span data-stu-id="7963e-133">Preview versions</span></span>

<span data-ttu-id="7963e-134">包维护人员可以决定包含共享框架和 SDK 的预览版。</span><span class="sxs-lookup"><span data-stu-id="7963e-134">Package maintainers may decide to include preview versions of the shared framework and SDK.</span></span> <span data-ttu-id="7963e-135">未进行版本控制的 `dotnet-sdk` 包中不的包含这些版本，但是可将其发布为已进行版本控制的包，并将额外的预览标记追加到该名称的主要和次要版本中。</span><span class="sxs-lookup"><span data-stu-id="7963e-135">Those should never be included in the unversioned `dotnet-sdk` package, but may be released as versioned packages with an additional preview marker appended to the major and minor version sections of the name.</span></span> <span data-ttu-id="7963e-136">例如，可以有 `dotnet-sdk-2.0-preview-final` 包。</span><span class="sxs-lookup"><span data-stu-id="7963e-136">For example, there may be a `dotnet-sdk-2.0-preview-final` package.</span></span>

### <a name="optional-additional-packages"></a><span data-ttu-id="7963e-137">可选的其他包</span><span class="sxs-lookup"><span data-stu-id="7963e-137">Optional additional packages</span></span>

<span data-ttu-id="7963e-138">一些维护人员可以选择提供其他包，例如：</span><span class="sxs-lookup"><span data-stu-id="7963e-138">Some maintainers may choose to provide additional packages such as:</span></span>

* <span data-ttu-id="7963e-139">`dotnet-lts`：共享框架的最新长期支持 (LTS) 版本。</span><span class="sxs-lookup"><span data-stu-id="7963e-139">`dotnet-lts`: the latest Long-Term Support (LTS) version of the shared framework.</span></span> <span data-ttu-id="7963e-140">[LTS 和当前版本系列](~/docs/core/versions/lts-current.md)对应 .NET Core 的不同发布阶段。</span><span class="sxs-lookup"><span data-stu-id="7963e-140">[LTS and Current release trains](~/docs/core/versions/lts-current.md) correspond to different cadences at which .NET Core gets released.</span></span> <span data-ttu-id="7963e-141">用户可以根据他们愿意进行更新的频率来选择采用某一个或其他系列。</span><span class="sxs-lookup"><span data-stu-id="7963e-141">Users have a choice of adopting one or the other train, based on how often they are willing to update.</span></span> <span data-ttu-id="7963e-142">此概念也与支持级别绑定，因此它可能有意义，也可能没有意义，具体取决于考虑使用的分发版。</span><span class="sxs-lookup"><span data-stu-id="7963e-142">This is a concept that is also tied to support levels, so it may or may not make sense depending on the distro being considered.</span></span>

## <a name="disk-layout"></a><span data-ttu-id="7963e-143">磁盘布局</span><span class="sxs-lookup"><span data-stu-id="7963e-143">Disk layout</span></span>

<span data-ttu-id="7963e-144">安装 .NET Core 包时，其目标目的地在磁盘上的相对位置。</span><span class="sxs-lookup"><span data-stu-id="7963e-144">When installing .NET Core packages, the relative placement of their target destinations on disk matter.</span></span>
<span data-ttu-id="7963e-145">`dotnet.exe` 主机应位于包含 `dotnet-sdk` SDK 包和 `dotnet-runtime` 共享框架包的已进行版本控制的内容的 `sdk` 和 `shared` 文件夹旁边。</span><span class="sxs-lookup"><span data-stu-id="7963e-145">The `dotnet.exe` host should be placed next to `sdk` and `shared` folders that contain the versioned contents of the `dotnet-sdk` SDK packages, and `dotnet-runtime` shared framework packages.</span></span>

<span data-ttu-id="7963e-146">包内的文件和目录的磁盘布局已进行版本控制。</span><span class="sxs-lookup"><span data-stu-id="7963e-146">The disk layout of files and directories inside the packages is versioned.</span></span> <span data-ttu-id="7963e-147">这表示更新到最新的 `dotnet-runtime` 会将新版本与之前的版本并行安装，从而降低了更新包后中断现有应用程序的可能性。</span><span class="sxs-lookup"><span data-stu-id="7963e-147">This means that updating to the latest `dotnet-runtime` installs the new version side by side with previous versions, reducing the possibility of breaking existing applications by updating the package.</span></span> <span data-ttu-id="7963e-148">包更新不应删除之前的版本。</span><span class="sxs-lookup"><span data-stu-id="7963e-148">Package updates should not remove previous versions.</span></span>

## <a name="update-policies"></a><span data-ttu-id="7963e-149">更新策略</span><span class="sxs-lookup"><span data-stu-id="7963e-149">Update policies</span></span>

<span data-ttu-id="7963e-150">执行 `update` 后，各个包的行为如下所示：</span><span class="sxs-lookup"><span data-stu-id="7963e-150">When an `update` is performed, the behavior of each package is as follows:</span></span>

* <span data-ttu-id="7963e-151">`dotnet-runtime-[major].[minor]`：新的修补程序版本更新此包，但是新的次要和主要版本是独立的包。</span><span class="sxs-lookup"><span data-stu-id="7963e-151">`dotnet-runtime-[major].[minor]`: new patch versions update the package, but new minor or major versions are separate packages.</span></span>
* <span data-ttu-id="7963e-152">`dotnet-sdk`：`update` 前滚主要、次要和修补程序版本。</span><span class="sxs-lookup"><span data-stu-id="7963e-152">`dotnet-sdk`: `update` rolls forward major, minor, and patch versions.</span></span>
* <span data-ttu-id="7963e-153">`dotnet-sdk-[major].[minor]`：新的修补程序版本更新此包，但是新的次要和主要版本是独立的包。</span><span class="sxs-lookup"><span data-stu-id="7963e-153">`dotnet-sdk-[major].[minor]`: new patch versions update the package, but new minor or major versions are separate packages.</span></span>
* <span data-ttu-id="7963e-154">`dotnet-lts`：`update` 前滚主要、次要和修补程序版本。</span><span class="sxs-lookup"><span data-stu-id="7963e-154">`dotnet-lts`: `update` rolls forward major, minor, and patch versions.</span></span>

<span data-ttu-id="7963e-155">本主题已介绍了对打包 .NET Core 的建议，但是各个分发版可随意选择提供何种版本及何时提供。</span><span class="sxs-lookup"><span data-stu-id="7963e-155">This topic has presented our recommendations for packaging .NET Core, however each distro is free to choose what versions to offer and when.</span></span> <span data-ttu-id="7963e-156">例如，与保持最新相比，更注重稳定性的分发版可以选择仅发布与 LTS 版本系列贴近的版本。</span><span class="sxs-lookup"><span data-stu-id="7963e-156">For example, a distro that values stability more than being up-to-date may choose to release only versions that snap with the LTS release train.</span></span>