---
title: "在 WCF 中排队"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: e98d76ba-1acf-42cd-b137-0f8214661112
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: d1364aa4284bcc858a9164f78e14daecc1a3ad54
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/02/2017
---
# <a name="queuing-in-wcf"></a><span data-ttu-id="8e3b6-102">在 WCF 中排队</span><span class="sxs-lookup"><span data-stu-id="8e3b6-102">Queuing in WCF</span></span>
<span data-ttu-id="8e3b6-103">本节描述如何使用 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 中的排队通信。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-103">This section describes how to use queued communication in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span>  
  
## <a name="queues-as-a-wcf-transport-binding"></a><span data-ttu-id="8e3b6-104">作为 WCF 传输绑定进行排队</span><span class="sxs-lookup"><span data-stu-id="8e3b6-104">Queues as a WCF transport binding</span></span>  
 <span data-ttu-id="8e3b6-105">在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中，协定指定要交换的内容。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-105">In [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the contracts specify what is being exchanged.</span></span> <span data-ttu-id="8e3b6-106">协定是业务相关或应用程序特定的消息交换。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-106">Contracts are business-dependent or application-specific message exchanges.</span></span> <span data-ttu-id="8e3b6-107">用于交换消息的机制（或“方式”）在绑定中指定。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-107">The mechanism used to exchange messages (or the "how") is specified in the bindings.</span></span> <span data-ttu-id="8e3b6-108">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的绑定包装消息交换的详细信息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-108">Bindings in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] encapsulate details of the message exchange.</span></span> <span data-ttu-id="8e3b6-109">它们为用户公开配置旋钮以控制绑定所表示的传输或协议的各个方面。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-109">They expose configuration knobs for the user to control various aspects of the transport or the protocol that the bindings represent.</span></span> <span data-ttu-id="8e3b6-110">对在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中排队的处理方式与其他任何传输绑定类似，这对于很多排队应用程序而言优势巨大。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-110">Queuing in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is treated like any other transport binding, which is a big advantage for many queuing applications.</span></span> <span data-ttu-id="8e3b6-111">当今，很多排队应用程序的编写方式不同于其他远程过程调用 (RPC) 样式的分布式应用程序，这使得遵循和维护更加困难。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-111">Today, many queuing applications are written differently from other remote procedure call (RPC)-style distributed applications, making it harder to follow and maintain.</span></span> <span data-ttu-id="8e3b6-112">使用 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]，编写分布式应用程序的风格非常相似，能使遵循和维护更为轻松。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-112">With [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the style of writing a distributed application is much the same, making it easier to follow and maintain.</span></span> <span data-ttu-id="8e3b6-113">而且，将交换机制从业务逻辑中单独分离出来后，就可以更为轻松地配置传输或对其进行更改，而不会影响应用程序特定的代码。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-113">Moreover, by factoring out the mechanism of exchange separately from the business logic, it is easier to configure the transport or make changes to it without affecting application specific code.</span></span> <span data-ttu-id="8e3b6-114">下图演示将 MSMQ 用作传输的 WCF 服务和客户端的结构。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-114">The following figure illustrates the structure of a WCF service and client using MSMQ as a transport.</span></span>  
  
 <span data-ttu-id="8e3b6-115">![排队应用程序关系图](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "分布式队列图")</span><span class="sxs-lookup"><span data-stu-id="8e3b6-115">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="8e3b6-116">如前图所示，客户端和服务必须仅定义应用程序语义，即协定及实现。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-116">As you can see from the preceding figure, the client and service must define only the application semantics, that is, the contract and implementation.</span></span> <span data-ttu-id="8e3b6-117">服务用首选设置来配置排队绑定。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-117">The service configures a queued binding with preferred settings.</span></span> <span data-ttu-id="8e3b6-118">客户端使用[ServiceModel 元数据实用工具 (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)生成[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]客户端到服务并生成一个配置文件，描述用于将消息发送到服务的绑定。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-118">The client uses the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md) to generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client to the service and to generate a configuration file that describes the bindings to use to send messages to the service.</span></span> <span data-ttu-id="8e3b6-119">因此，若要发送排队消息，客户端需要实例化 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 客户端，并在其上调用操作。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-119">Thus, to send a queued message, the client instantiates a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and invokes an operation on it.</span></span> <span data-ttu-id="8e3b6-120">这会导致将消息发送到传输队列，然后再传输到目标队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-120">This causes the message to be sent to the transmission queue and transferred to the target queue.</span></span> <span data-ttu-id="8e3b6-121">排队通信的所有复杂程度都将从发送和接收消息的应用程序中隐藏。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-121">All the complexities of queued communication are hidden from the application that is sending and receiving messages.</span></span>  
  
 <span data-ttu-id="8e3b6-122">关于 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的排队绑定的警告包括：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-122">Caveats about queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] include:</span></span>  
  
-   <span data-ttu-id="8e3b6-123">所有服务操作必须均为单向，原因是 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的默认排队绑定不支持使用队列进行双工通信。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-123">All service operations must be one-way because the default queued binding in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] does not support duplex communication using queues.</span></span> <span data-ttu-id="8e3b6-124">双向通信示例 ([双向通信](../../../../docs/framework/wcf/samples/two-way-communication.md)) 演示了如何使用两个单向协定来实现使用队列进行双工通信。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-124">A two-way communication sample ([Two-Way Communication](../../../../docs/framework/wcf/samples/two-way-communication.md)) illustrates how to use two one-way contracts to implement duplex communication using queues.</span></span>  
  
-   <span data-ttu-id="8e3b6-125">若要生成使用元数据交换的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 客户端，要求服务上有一个额外的 HTTP 终结点，以便可以对该终结点直接查询，进而生成 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 客户端并获取用于适当配置排队通信的绑定信息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-125">To generate a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client using metadata exchange requires an additional HTTP endpoint on the service so that it can be queried directly to generate the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and obtain binding information to appropriately configure queued communication.</span></span>  
  
-   <span data-ttu-id="8e3b6-126">根据排队绑定，要求在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 外部进行额外配置。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-126">Based on the queued binding, extra configuration outside of [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is required.</span></span> <span data-ttu-id="8e3b6-127">例如，<xref:System.ServiceModel.NetMsmqBinding> 随带的 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 类要求配置绑定并对消息队列 (MSMQ) 进行最低配置。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-127">For example, the <xref:System.ServiceModel.NetMsmqBinding> class that is shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] requires you to configure the bindings as well as minimally configure Message Queuing (MSMQ).</span></span>  
  
 <span data-ttu-id="8e3b6-128">后面几节描述 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 附带的基于 MSMQ 的特定排队绑定。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-128">The following sections describe the specific queued bindings shipped with [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], which are based on MSMQ.</span></span>  
  
### <a name="msmq"></a><span data-ttu-id="8e3b6-129">MSMQ</span><span class="sxs-lookup"><span data-stu-id="8e3b6-129">MSMQ</span></span>  
 <span data-ttu-id="8e3b6-130">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的排队传输使用 MSMQ 进行排队通信。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-130">The queued transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] uses MSMQ for its queued communication.</span></span>  
  
 <span data-ttu-id="8e3b6-131">MSMQ 作为可选组件随 Windows 提供，并作为 NT 服务运行。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-131">MSMQ ships as an optional component with Windows and runs as an NT service.</span></span> <span data-ttu-id="8e3b6-132">它在传输队列中捕获传输消息，并在目标队列中捕获传递消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-132">It captures messages for transmission in a transmission queue and for delivery in a target queue.</span></span> <span data-ttu-id="8e3b6-133">MSMQ 队列管理器实现可靠的消息传输协议，以使消息不会在传输过程中丢失。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-133">The MSMQ queue managers implement a reliable message-transfer protocol so that messages are not lost in transmission.</span></span> <span data-ttu-id="8e3b6-134">此协议可以是本机的，也可以是基于 SOAP 的，如 SOAP 可靠消息协议 (SRMP)。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-134">The protocol can be either native or SOAP-based, such as the SOAP Reliable Message Protocol (SRMP).</span></span>  
  
 <span data-ttu-id="8e3b6-135">在 MSMQ 中，队列可以是事务性的，也可以是非事务性的。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-135">In MSMQ, queues can be transactional or non-transactional.</span></span> <span data-ttu-id="8e3b6-136">通过事务性队列，可以在事务中捕获和传递消息，然后将这些消息永久地存储在队列中。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-136">A transactional queue allows messages to be captured and delivered in a transaction and then stored durably in the queue.</span></span> <span data-ttu-id="8e3b6-137">发送至事务性队列的消息仅按顺序传输一次。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-137">Messages sent to a transactional queue are transferred exactly once in order.</span></span> <span data-ttu-id="8e3b6-138">可以使用非事务性队列发送可变消息和持久性消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-138">You can use a non-transactional queue to send both volatile and durable messages.</span></span> <span data-ttu-id="8e3b6-139">发送到非事务性队列的消息不具有任何可靠传输保证，因而消息可能会丢失。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-139">A message sent to a non-transactional queue does not carry any reliable transfer assurances; thus, messages can be lost.</span></span>  
  
 <span data-ttu-id="8e3b6-140">也可以使用向 Active Directory 目录服务注册的 Windows 标识对 MSMQ 队列进行保护。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-140">MSMQ queues can also be secured using a Windows identity registered with the Active Directory directory service.</span></span> <span data-ttu-id="8e3b6-141">安装 MSMQ 时，可以安装 Active Directory 集成，这要求计算机加入 Windows 域网络。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-141">When installing MSMQ, you can install Active Directory integration, which requires the computer to be part of a Windows domain network.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="8e3b6-142">MSMQ，请参阅[安装消息队列 (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md)。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-142"> MSMQ, see [Installing Message Queuing (MSMQ)](../../../../docs/framework/wcf/samples/installing-message-queuing-msmq.md).</span></span>  
  
### <a name="netmsmqbinding"></a><span data-ttu-id="8e3b6-143">NetMsmqBinding</span><span class="sxs-lookup"><span data-stu-id="8e3b6-143">NetMsmqBinding</span></span>  
 <span data-ttu-id="8e3b6-144">[ \<NetMsmqBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md)是排队的绑定[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]提供两个[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]终结点使用 MSMQ 进行通信。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-144">The [\<netMsmqBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/netmsmqbinding.md) is the queued binding [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides for two [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoints to communicate using MSMQ.</span></span> <span data-ttu-id="8e3b6-145">因此，该绑定将公开特定于 MSMQ 的属性。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-145">The binding, therefore, exposes properties that are specific to MSMQ.</span></span> <span data-ttu-id="8e3b6-146">然而，并非所有 MSMQ 功能和属性都在 `NetMsmqBinding` 中公开。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-146">However, not all MSMQ features and properties are exposed in the `NetMsmqBinding`.</span></span> <span data-ttu-id="8e3b6-147">紧凑 `NetMsmqBinding` 设计为具有一组大多数客户都认为足够的最佳功能。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-147">The compact `NetMsmqBinding` is designed with an optimal set of features that most customers should find sufficient.</span></span>  
  
 <span data-ttu-id="8e3b6-148">`NetMsmqBinding` 以绑定上的属性形式阐明了迄今为止所讨论的核心队列概念。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-148">The `NetMsmqBinding` manifests the core queuing concepts discussed thus far in the form of properties on the bindings.</span></span> <span data-ttu-id="8e3b6-149">而这些属性又向 MSMQ 传达如何传输和传递消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-149">These properties, in turn, communicate to MSMQ how to transfer and deliver the messages.</span></span> <span data-ttu-id="8e3b6-150">后面几节将讨论属性类别。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-150">A discussion of the property categories is in the following sections.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="8e3b6-151">更完整地描述特定属性的概念性主题。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-151"> the conceptual topics that describe specific properties more completely.</span></span>  
  
#### <a name="exactlyonce-and-durable-properties"></a><span data-ttu-id="8e3b6-152">ExactlyOnce 和 Durable 属性</span><span class="sxs-lookup"><span data-stu-id="8e3b6-152">ExactlyOnce and Durable Properties</span></span>  
 <span data-ttu-id="8e3b6-153">`ExactlyOnce` 和 `Durable` 属性影响消息在队列之间的传输方式：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-153">The `ExactlyOnce` and `Durable` properties affect how messages are transferred between queues:</span></span>  
  
-   <span data-ttu-id="8e3b6-154">`ExactlyOnce`：当设置为 `true`（默认值）时，排队通道可确保消息在传递时不会重复，</span><span class="sxs-lookup"><span data-stu-id="8e3b6-154">`ExactlyOnce`: When set to `true` (the default), the queued channel ensures that the message, if delivered, is not duplicated.</span></span> <span data-ttu-id="8e3b6-155">还可确保消息不会丢失。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-155">It also ensures that the message is not lost.</span></span> <span data-ttu-id="8e3b6-156">如果无法传递消息，或在传递消息前已超过消息的生存时间，则将在死信队列中记录传递失败的消息以及失败原因。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-156">If the message cannot be delivered, or the message Time-To Live expires before the message can be delivered, the failed message along with the delivery failure reason is recorded in a dead-letter queue.</span></span> <span data-ttu-id="8e3b6-157">当设置为 `false` 时，排队通道将尽量传输消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-157">When set to `false`, the queued channel makes an effort to transfer the message.</span></span> <span data-ttu-id="8e3b6-158">在这种情况下，可以任意选择一个死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-158">In this case, you can optionally choose a dead-letter queue.</span></span>  
  
-   <span data-ttu-id="8e3b6-159">`Durable:`：当设置为 `true`（默认值）时，排队通道确保 MSMQ 将消息永久存储在磁盘上。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-159">`Durable:` When set to `true` (the default), the queued channel ensures that MSMQ stores the message durably on disk.</span></span> <span data-ttu-id="8e3b6-160">因而，如果 MSMQ 服务要停止并重新启动，则磁盘上的消息将传输到目标队列或传递到服务。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-160">Thus, if the MSMQ service were to stop and restart, the messages on disk is transferred to the target queue or delivered to the service.</span></span> <span data-ttu-id="8e3b6-161">当设置为 `false` 时，消息将存储在可变存储区中，而且会在停止并重新启动 MSMQ 服务时丢失。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-161">When set to `false`, the messages are stored in volatile store and are lost on stopping and restarting the MSMQ service.</span></span>  
  
 <span data-ttu-id="8e3b6-162">对于 `ExactlyOnce` 可靠传输，MSMQ 要求队列是事务性队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-162">For `ExactlyOnce` reliable transfer, MSMQ requires the queue to be transactional.</span></span> <span data-ttu-id="8e3b6-163">同时，MSMQ 还需要一个从事务性队列中进行读取的事务。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-163">Also, MSMQ requires a transaction to read from a transactional queue.</span></span> <span data-ttu-id="8e3b6-164">同样，在使用 `NetMsmqBinding` 时，请记住，如果将 `ExactlyOnce` 设置为 `true`，则需要使用事务来发送或接收消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-164">As such, when you use the `NetMsmqBinding`, remember that a transaction is required to send or receive messages when `ExactlyOnce` is set to `true`.</span></span> <span data-ttu-id="8e3b6-165">与此类似，MSMQ 要求队列为非事务性队列来实现高效保证，例如，当 `ExactlyOnce` 为 `false` 以及进行可变消息传递时。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-165">Similarly, MSMQ requires the queue to be non-transactional for best-effort assurances, such as when `ExactlyOnce` is `false` and for volatile messaging.</span></span> <span data-ttu-id="8e3b6-166">因此，将 `ExactlyOnce` 设置为 `false`，或将 durable 设置为 `false` 时，将无法使用事务发送或接收消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-166">Thus, when setting `ExactlyOnce` to `false` or durable to `false`, you cannot send or receive using a transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8e3b6-167">确保基于绑定中的设置创建正确的队列（事务性或非事务性）。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-167">Ensure that the correct queue (transactional or non-transactional) is created based on settings in the bindings.</span></span> <span data-ttu-id="8e3b6-168">如果 `ExactlyOnce` 为 `true`，则使用事务性队列；否则，使用非事务性队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-168">If `ExactlyOnce` is `true`, use a transactional queue; otherwise, use a non-transactional queue.</span></span>  
  
#### <a name="dead-letter-queue-properties"></a><span data-ttu-id="8e3b6-169">死信队列属性</span><span class="sxs-lookup"><span data-stu-id="8e3b6-169">Dead-Letter Queue Properties</span></span>  
 <span data-ttu-id="8e3b6-170">死信队列用于存储传递失败的消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-170">The dead-letter queue is used to store messages that fail delivery.</span></span> <span data-ttu-id="8e3b6-171">用户可以编写补偿逻辑来从死信队列中读取消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-171">The user can write compensating logic that reads messages out of the dead-letter queue.</span></span>  
  
 <span data-ttu-id="8e3b6-172">很多队列系统都提供系统级死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-172">Many queuing systems provide for a system-wide dead-letter queue.</span></span> <span data-ttu-id="8e3b6-173">MSMQ 为向非事务性队列传递失败的消息提供一个系统级非事务性死信队列，为向事务性队列传递失败的消息提供一个系统级事务性死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-173">MSMQ provides a system-wide non-transactional dead-letter queue for messages that fail delivery to non-transactional queues and a system-wide transactional dead-letter queue for messages that fail delivery to transactional queues.</span></span>  
  
 <span data-ttu-id="8e3b6-174">如果向不同目标队列发送消息的多个客户端共享 MSMQ 服务，则客户端发送的所有消息将转到同一个死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-174">If multiple clients sending messages to different target queues share the MSMQ service, all messages sent by the clients go to the same dead-letter queue.</span></span> <span data-ttu-id="8e3b6-175">这并不总是可取的。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-175">This is not always preferable.</span></span> <span data-ttu-id="8e3b6-176">为了更好地进行隔离，[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的 [!INCLUDE[wv](../../../../includes/wv-md.md)] 和 MSMQ 提供了用户可以指定的自定义死信队列（或应用程序特定的死信队列）来存储传递失败的消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-176">For better isolation, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] and MSMQ in [!INCLUDE[wv](../../../../includes/wv-md.md)] provide a custom dead-letter queue (or application-specific dead-letter queue) that the user can specify to store messages that fail delivery.</span></span> <span data-ttu-id="8e3b6-177">因此，不同的客户端并不共享同一个死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-177">Therefore, different clients do not share the same dead-letter queue.</span></span>  
  
 <span data-ttu-id="8e3b6-178">绑定具有两个相关属性：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-178">The binding has two properties of interest:</span></span>  
  
-   <span data-ttu-id="8e3b6-179">`DeadLetterQueue`：该属性是一个枚举，指示是否请求死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-179">`DeadLetterQueue`: This property is an enumeration that indicates whether a dead-letter queue is requested.</span></span> <span data-ttu-id="8e3b6-180">如果请求某类死信队列，则该枚举还包含这种死信队列。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-180">The enumeration also contains the kind of dead-letter queue, if one is requested.</span></span> <span data-ttu-id="8e3b6-181">该属性的值为 `None`、`System` 和 `Custom`。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-181">The values are `None`, `System`, and `Custom`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="8e3b6-182">这些属性的解释，请参阅[使用死信队列的处理消息传输失败](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span><span class="sxs-lookup"><span data-stu-id="8e3b6-182"> the interpretation of these properties, see [Using Dead-Letter Queues to Handle Message Transfer Failures](../../../../docs/framework/wcf/feature-details/using-dead-letter-queues-to-handle-message-transfer-failures.md)</span></span>  
  
-   <span data-ttu-id="8e3b6-183">`CustomDeadLetterQueue`：该属性是应用程序特定死信队列的统一资源标识符 (URI) 地址。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-183">`CustomDeadLetterQueue`: This property is the Uniform Resource Identifier (URI) address of the application-specific dead-letter queue.</span></span> <span data-ttu-id="8e3b6-184">如果这是必需`DeadLetterQueue`。`Custom`</span><span class="sxs-lookup"><span data-stu-id="8e3b6-184">This is required if `DeadLetterQueue`.`Custom`</span></span> <span data-ttu-id="8e3b6-185">选择。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-185">is chosen.</span></span>  
  
#### <a name="poison-message-handling-properties"></a><span data-ttu-id="8e3b6-186">病毒消息处理属性</span><span class="sxs-lookup"><span data-stu-id="8e3b6-186">Poison Message Handling properties</span></span>  
 <span data-ttu-id="8e3b6-187">当服务从事务中的目标队列读取消息时，服务可能由于种种原因而无法处理消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-187">When the service reads messages from the target queue under a transaction, the service may fail to process the message for various reasons.</span></span> <span data-ttu-id="8e3b6-188">然后，将消息放回队列以备再次读取。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-188">The message is then put back into the queue to be read again.</span></span> <span data-ttu-id="8e3b6-189">若要处理反复失败的消息，可以在绑定中配置一组病毒消息处理属性。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-189">To deal with messages that fail repeatedly, a set of poison-message handling properties can be configured in the binding.</span></span> <span data-ttu-id="8e3b6-190">有如下四个属性：`ReceiveRetryCount`、`MaxRetryCycles`、`RetryCycleDelay` 和 `ReceiveErrorHandling`。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-190">There are four properties: `ReceiveRetryCount`, `MaxRetryCycles`, `RetryCycleDelay`, and `ReceiveErrorHandling`.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="8e3b6-191">这些属性，请参阅[的病毒消息处理](../../../../docs/framework/wcf/feature-details/poison-message-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-191"> these properties, see [Poison Message Handling](../../../../docs/framework/wcf/feature-details/poison-message-handling.md).</span></span>  
  
#### <a name="security-properties"></a><span data-ttu-id="8e3b6-192">安全属性</span><span class="sxs-lookup"><span data-stu-id="8e3b6-192">Security Properties</span></span>  
 <span data-ttu-id="8e3b6-193">MSMQ 公开其自己的安全模型，如队列上的访问控制列表 (ACL) 或发送经过验证身份的消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-193">MSMQ exposes its own security model, such as access control lists (ACLs) on a queue or sending authenticated messages.</span></span> <span data-ttu-id="8e3b6-194">`NetMsmqBinding` 将这些安全属性作为其传输安全设置的一部分而公开。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-194">The `NetMsmqBinding` exposes these security properties as part of its transport security settings.</span></span> <span data-ttu-id="8e3b6-195">绑定中有两个用于传输安全的属性：`MsmqAuthenticationMode` 和 `MsmqProtectionLevel`。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-195">There are two properties in the binding for transport security: `MsmqAuthenticationMode` and `MsmqProtectionLevel`.</span></span> <span data-ttu-id="8e3b6-196">这些属性中的设置取决于 MSMQ 的配置方式。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-196">Settings in these properties depend on how MSMQ is configured.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="8e3b6-197">[使用传输安全保护消息](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-197"> [Securing Messages Using Transport Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md).</span></span>  
  
 <span data-ttu-id="8e3b6-198">除了传输安全，实际的 SOAP 消息本身也可以使用消息安全来进行保护。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-198">In addition to transport security, the actual SOAP message itself can be secured using message security.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="8e3b6-199">[使用消息安全保护消息](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md)。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-199"> [Securing Messages Using Message Security](../../../../docs/framework/wcf/feature-details/securing-messages-using-message-security.md).</span></span>  
  
 <span data-ttu-id="8e3b6-200">`MsmqTransportSecurity` 还公开两个属性，即 `MsmqEncryptionAlgorithm` 和 `MsmqHashAlgorithm`。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-200">`MsmqTransportSecurity` also exposes two properties, `MsmqEncryptionAlgorithm` and `MsmqHashAlgorithm`.</span></span> <span data-ttu-id="8e3b6-201">这些是要为消息的队列到队列传输加密和签名的哈希选择的不同算法的枚举。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-201">These are enumerations of different algorithms to choose for queue-to-queue transfer encryption of messages and hashing of the signatures.</span></span>  
  
#### <a name="other-properties"></a><span data-ttu-id="8e3b6-202">其他属性</span><span class="sxs-lookup"><span data-stu-id="8e3b6-202">Other Properties</span></span>  
 <span data-ttu-id="8e3b6-203">除了上述各属性，在绑定中公开的其他 MSMQ 特定的属性还包括：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-203">In addition to the preceding properties, other MSMQ-specific properties exposed in the binding include:</span></span>  
  
-   <span data-ttu-id="8e3b6-204">`UseSourceJournal`：指示打开源日记记录的属性。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-204">`UseSourceJournal`: A property to indicate that source journaling is turned on.</span></span> <span data-ttu-id="8e3b6-205">源日记记录是一项 MSMQ 功能，用于跟踪从传输队列成功传输的消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-205">Source journaling is an MSMQ feature that keeps track of messages that have been successfully transmitted from the transmission queue.</span></span>  
  
-   <span data-ttu-id="8e3b6-206">`UseMsmqTracing`：指示打开 MSMQ 跟踪的属性。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-206">`UseMsmqTracing`: A property to indicate that MSMQ tracing is turned on.</span></span> <span data-ttu-id="8e3b6-207">每当消息离开或到达承载 MSMQ 队列管理器的计算机时，MSMQ 跟踪都会向报告队列发送报告消息。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-207">MSMQ tracing sends report messages to a report queue each time a message leaves or arrives at a machine hosting an MSMQ queue manager.</span></span>  
  
-   <span data-ttu-id="8e3b6-208">`QueueTransferProtocol`：要用于队列到队列的消息传输的协议的枚举。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-208">`QueueTransferProtocol`: An enumeration of the protocol to use for queue-to-queue message transfers.</span></span> <span data-ttu-id="8e3b6-209">MSMQ 实现本机队列到队列的传输协议和称为 SOAP 可靠消息传输协议 (SRMP) 的基于 SOAP 的协议。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-209">MSMQ implements a native queue-to-queue transfer protocol and a SOAP-based protocol called SOAP Reliable Messaging Protocol (SRMP).</span></span> <span data-ttu-id="8e3b6-210">当使用 HTTP 传输进行队列到队列的传输时将使用 SRMP。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-210">SRMP is used when using HTTP transport for queue-to-queue transfers.</span></span> <span data-ttu-id="8e3b6-211">当使用 HTTPS 进行队列到队列的传输时将使用 SRMP 安全。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-211">SRMP secure is used when using HTTPS for queue-to-queue transfers.</span></span>  
  
-   <span data-ttu-id="8e3b6-212">`UseActiveDirectory`：一个布尔值，指示是否必须使用 Active Directory 进行队列地址解析。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-212">`UseActiveDirectory`: A Boolean value to indicate whether the Active Directory must be used for queue address resolution.</span></span> <span data-ttu-id="8e3b6-213">默认情况下，此功能处于关闭状态。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-213">By default, this is off.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="8e3b6-214">[服务终结点和队列寻址](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-214"> [Service Endpoints and Queue Addressing](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md).</span></span>  
  
### <a name="msmqintegrationbinding"></a><span data-ttu-id="8e3b6-215">MsmqIntegrationBinding</span><span class="sxs-lookup"><span data-stu-id="8e3b6-215">MsmqIntegrationBinding</span></span>  
 <span data-ttu-id="8e3b6-216">当希望 `MsmqIntegrationBinding` 终结点与用 C、C++、COM 或 System.Messaging API 编写的现有 MSMQ 应用程序通信时，请使用 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-216">The `MsmqIntegrationBinding` is used when you want a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] endpoint to communicate with an existing MSMQ application written in C, C++, COM, or System.Messaging APIs.</span></span>  
  
 <span data-ttu-id="8e3b6-217">对于 `NetMsmqBinding`，绑定属性基本相同。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-217">The binding properties are the same as for `NetMsmqBinding`.</span></span> <span data-ttu-id="8e3b6-218">不过，存在以下差异：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-218">However, the following differences apply:</span></span>  
  
-   <span data-ttu-id="8e3b6-219">将 `MsmqIntegrationBinding` 的操作协定限制为采用一个类型为 <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> 的参数，其中类型参数为正文类型。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-219">The operation contract for `MsmqIntegrationBinding` is restricted to taking a single parameter of type <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> where the type parameter is the body type.</span></span>  
  
-   <span data-ttu-id="8e3b6-220">很多 MSMQ 本机消息属性都在 <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> 中公开以供使用。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-220">Much of MSMQ native message properties are exposed in the <xref:System.ServiceModel.MsmqIntegration.MsmqMessage%601> for use.</span></span>  
  
-   <span data-ttu-id="8e3b6-221">为帮助对消息正文进行序列化和反序列化，提供了若干序列化程序，如 XML 和 ActiveX。</span><span class="sxs-lookup"><span data-stu-id="8e3b6-221">To help with serialization and deserialization of the message body, serializers such as XML and ActiveX are provided.</span></span>  
  
### <a name="sample-code"></a><span data-ttu-id="8e3b6-222">代码示例</span><span class="sxs-lookup"><span data-stu-id="8e3b6-222">Sample Code</span></span>  
 <span data-ttu-id="8e3b6-223">有关编写使用 MSMQ 的 WCF 服务的分步指导，请参见下列主题：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-223">For step by step instructions on how to write WCF services that use MSMQ see the following topics:</span></span>  
  
-   [<span data-ttu-id="8e3b6-224">如何： 与 WCF 终结点交换消息和消息队列应用程序</span><span class="sxs-lookup"><span data-stu-id="8e3b6-224">How to: Exchange Messages with WCF Endpoints and Message Queuing Applications</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-messages-with-wcf-endpoints-and-message-queuing-applications.md)  
  
-   [<span data-ttu-id="8e3b6-225">如何： 交换排队消息的 WCF 终结点</span><span class="sxs-lookup"><span data-stu-id="8e3b6-225">How to: Exchange Queued Messages with WCF Endpoints</span></span>](../../../../docs/framework/wcf/feature-details/how-to-exchange-queued-messages-with-wcf-endpoints.md)  
  
 <span data-ttu-id="8e3b6-226">有关说明 MSMQ 在 WCF 中的用法的完整代码示例，请参见下列主题：</span><span class="sxs-lookup"><span data-stu-id="8e3b6-226">For a completed code sample illustrating the use of MSMQ in WCF see the following topics:</span></span>  
  
-   [<span data-ttu-id="8e3b6-227">事务处理的 MSMQ 绑定</span><span class="sxs-lookup"><span data-stu-id="8e3b6-227">Transacted MSMQ Binding</span></span>](../../../../docs/framework/wcf/samples/transacted-msmq-binding.md)  
  
-   [<span data-ttu-id="8e3b6-228">可变排队通信</span><span class="sxs-lookup"><span data-stu-id="8e3b6-228">Volatile Queued Communication</span></span>](../../../../docs/framework/wcf/samples/volatile-queued-communication.md)  
  
-   [<span data-ttu-id="8e3b6-229">死信队列</span><span class="sxs-lookup"><span data-stu-id="8e3b6-229">Dead Letter Queues</span></span>](../../../../docs/framework/wcf/samples/dead-letter-queues.md)  
  
-   [<span data-ttu-id="8e3b6-230">会话和队列</span><span class="sxs-lookup"><span data-stu-id="8e3b6-230">Sessions and Queues</span></span>](../../../../docs/framework/wcf/samples/sessions-and-queues.md)  
  
-   [<span data-ttu-id="8e3b6-231">双向通信</span><span class="sxs-lookup"><span data-stu-id="8e3b6-231">Two-Way Communication</span></span>](../../../../docs/framework/wcf/samples/two-way-communication.md)  
  
-   [<span data-ttu-id="8e3b6-232">事务处理批处理</span><span class="sxs-lookup"><span data-stu-id="8e3b6-232">Transacted Batching</span></span>](../../../../docs/framework/wcf/samples/transacted-batching.md)  
  
-   [<span data-ttu-id="8e3b6-233">SRMP</span><span class="sxs-lookup"><span data-stu-id="8e3b6-233">SRMP</span></span>](../../../../docs/framework/wcf/samples/srmp.md)  
  
-   [<span data-ttu-id="8e3b6-234">通过消息队列的消息安全</span><span class="sxs-lookup"><span data-stu-id="8e3b6-234">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
  
## <a name="see-also"></a><span data-ttu-id="8e3b6-235">另请参阅</span><span class="sxs-lookup"><span data-stu-id="8e3b6-235">See Also</span></span>  
 [<span data-ttu-id="8e3b6-236">服务终结点和队列寻址</span><span class="sxs-lookup"><span data-stu-id="8e3b6-236">Service Endpoints and Queue Addressing</span></span>](../../../../docs/framework/wcf/feature-details/service-endpoints-and-queue-addressing.md)  
 [<span data-ttu-id="8e3b6-237">承载排队应用程序的 web</span><span class="sxs-lookup"><span data-stu-id="8e3b6-237">Web Hosting a Queued Application</span></span>](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md)
