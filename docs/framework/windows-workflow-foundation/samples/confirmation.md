---
title: 确认
ms.date: 03/30/2017
ms.assetid: 8637aeaf-ac9e-49b8-93f4-da15dee45277
ms.openlocfilehash: caa712aa52da01ce44335a361fd6c9f5215316bf
ms.sourcegitcommit: ba5c189bf44d44204a3e8838e59ec378a62d82f3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/13/2018
ms.locfileid: "44757232"
---
# <a name="confirmation"></a><span data-ttu-id="0e060-102">确认</span><span class="sxs-lookup"><span data-stu-id="0e060-102">Confirmation</span></span>
<span data-ttu-id="0e060-103">此示例演示针对 <xref:System.Activities.Statements.CompensableActivity> 的使用和确认的四种常见方案。</span><span class="sxs-lookup"><span data-stu-id="0e060-103">This sample shows four common scenarios surrounding the use of <xref:System.Activities.Statements.CompensableActivity> and confirmation.</span></span> <span data-ttu-id="0e060-104">此示例运行四个工作流以显示确认。</span><span class="sxs-lookup"><span data-stu-id="0e060-104">The sample runs four workflows to show confirmation.</span></span> <span data-ttu-id="0e060-105">此示例具有声明性版本和命令性版本。</span><span class="sxs-lookup"><span data-stu-id="0e060-105">This sample is available in declarative and imperative versions.</span></span>  
  
## <a name="confirm-a-compensable-activity"></a><span data-ttu-id="0e060-106">确认可补偿的活动</span><span class="sxs-lookup"><span data-stu-id="0e060-106">Confirm a Compensable Activity</span></span>  
 <span data-ttu-id="0e060-107">第一个工作流演示如何确认可补偿的活动，它由一个包含两个 <xref:System.Activities.Statements.CompensableActivity> 实例的序列组成。</span><span class="sxs-lookup"><span data-stu-id="0e060-107">The first workflow demonstrates how to confirm a compensable activity and consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> instances.</span></span> <span data-ttu-id="0e060-108">完成第二个 <xref:System.Activities.Statements.CompensableActivity> 之后，确认活动将确认第一个活动。</span><span class="sxs-lookup"><span data-stu-id="0e060-108">After the completion of the second <xref:System.Activities.Statements.CompensableActivity> a confirm activity confirms the first activity.</span></span> <span data-ttu-id="0e060-109">成功完成该工作流后，将按照默认顺序自动确认所有尚未确认和补偿的 <xref:System.Activities.Statements.CompensableActivity> 实例。</span><span class="sxs-lookup"><span data-stu-id="0e060-109">When the workflow successfully completes, all <xref:System.Activities.Statements.CompensableActivity> instances that have not been confirmed or compensated are automatically confirmed using the default order.</span></span> <span data-ttu-id="0e060-110">若不进行确认，则会首先确认第二个 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="0e060-110">Without the confirm, the second <xref:System.Activities.Statements.CompensableActivity> would have been confirmed first.</span></span>  
  
## <a name="explicit-compensation"></a><span data-ttu-id="0e060-111">显式补偿</span><span class="sxs-lookup"><span data-stu-id="0e060-111">Explicit Compensation</span></span>  
 <span data-ttu-id="0e060-112">第二种方案演示显示补偿 <xref:System.Activities.Statements.CompensableActivity> 对默认确认的影响。</span><span class="sxs-lookup"><span data-stu-id="0e060-112">The second scenario shows the affect on default confirmation when a <xref:System.Activities.Statements.CompensableActivity> is explicitly compensated.</span></span> <span data-ttu-id="0e060-113">此工作流由一个包含两个 <xref:System.Activities.Statements.CompensableActivity> 活动的序列组成，在第二个活动完成后，将显式补偿第一个活动。</span><span class="sxs-lookup"><span data-stu-id="0e060-113">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity> activities, after the second completes the first is explicitly compensated.</span></span> <span data-ttu-id="0e060-114">因此，在完成该工作流时，仅确认第二个 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="0e060-114">As a result when the workflow, completes only the second <xref:System.Activities.Statements.CompensableActivity> is confirmed.</span></span>  
  
## <a name="controlling-the-order-of-confirmation-for-nested-compensableactivity-activities"></a><span data-ttu-id="0e060-115">控制嵌套的 CompensableActivity 活动的确认顺序</span><span class="sxs-lookup"><span data-stu-id="0e060-115">Controlling the Order of Confirmation for Nested CompensableActivity Activities</span></span>  
 <span data-ttu-id="0e060-116">第三种方案演示如何控制嵌套的 <xref:System.Activities.Statements.CompensableActivity> 的确认顺序。</span><span class="sxs-lookup"><span data-stu-id="0e060-116">The third scenario shows how to control the order of confirmation for nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="0e060-117">此方案包含一个作为工作流的根的 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="0e060-117">The scenario consists of a <xref:System.Activities.Statements.CompensableActivity> as the root of the workflow.</span></span> <span data-ttu-id="0e060-118">根 <xref:System.Activities.Statements.CompensableActivity> 的主体是一个包含三个 <xref:System.Activities.Statements.CompensableActivity> 的序列。</span><span class="sxs-lookup"><span data-stu-id="0e060-118">The body of the root <xref:System.Activities.Statements.CompensableActivity> is a sequence of three <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="0e060-119">根 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 的 <xref:System.Activities.Statements.CompensableActivity> 是一个序列，此序列指定先确认第一个活动，然后再确认第二个嵌套的 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="0e060-119">The <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> for the root <xref:System.Activities.Statements.CompensableActivity> is a sequence that specifies to confirm the first then the second nested <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="0e060-120">该工作流在完成时确认根 <xref:System.Activities.Statements.CompensableActivity>，然后依次确认第一个、第二个和第三个嵌套的 <xref:System.Activities.Statements.CompensableActivity>。</span><span class="sxs-lookup"><span data-stu-id="0e060-120">When the workflow completes it confirms the root <xref:System.Activities.Statements.CompensableActivity>, which then confirms the first, second and third nested <xref:System.Activities.Statements.CompensableActivity>, in that order.</span></span> <span data-ttu-id="0e060-121">因此，默认的确认顺序实际上是相反的。</span><span class="sxs-lookup"><span data-stu-id="0e060-121">As a result, the default confirmation order is essentially reversed.</span></span> <span data-ttu-id="0e060-122">由于 <xref:System.Activities.Statements.CompensableActivity> 未将第三个 <xref:System.Activities.Statements.CompensableActivity> 显式确认为根 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 的一部分，因此将按照默认顺序对其进行确认。</span><span class="sxs-lookup"><span data-stu-id="0e060-122">Because the third <xref:System.Activities.Statements.CompensableActivity> was not explicitly confirmed as part of the root <xref:System.Activities.Statements.CompensableActivity> by the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A>, it is confirmed according to the default order.</span></span> <span data-ttu-id="0e060-123">但由于它是唯一未确认的 <xref:System.Activities.Statements.CompensableActivity>，这表示将对其进行确认。</span><span class="sxs-lookup"><span data-stu-id="0e060-123">However, because it is the only unconfirmed <xref:System.Activities.Statements.CompensableActivity> this just means it is confirmed.</span></span>  
  
## <a name="scoping-of-variables"></a><span data-ttu-id="0e060-124">变量的范围</span><span class="sxs-lookup"><span data-stu-id="0e060-124">Scoping of Variables</span></span>  
 <span data-ttu-id="0e060-125">第四种方案演示如何在执行 <xref:System.Activities.Statements.CompensableActivity>、 <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A> 或 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 处理程序时使为 <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> 或其某个父级定义的变量生存期仍处于范围内，即使活动已完成或工作流已完成。</span><span class="sxs-lookup"><span data-stu-id="0e060-125">The fourth scenario shows how the lifetime of variables defined for a <xref:System.Activities.Statements.CompensableActivity> or one of their parents are still in scope when the <xref:System.Activities.Statements.CompensableActivity.CompensationHandler%2A>, <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> or <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> handlers are executed even if the activity has completed or the workflow has completed.</span></span> <span data-ttu-id="0e060-126">此工作流由一个包含两个 <xref:System.Activities.Statements.CompensableActivity> 的序列组成。</span><span class="sxs-lookup"><span data-stu-id="0e060-126">The workflow consists of a sequence of two <xref:System.Activities.Statements.CompensableActivity>.</span></span> <span data-ttu-id="0e060-127">在第一个活动的正文中，将变量 `mySum` 设置为 5 与 10 以及输出结果的和值。</span><span class="sxs-lookup"><span data-stu-id="0e060-127">In the body of the first, the variable `mySum` is set to the sum of 5 and 10 and the result printed.</span></span> <span data-ttu-id="0e060-128">在第二个 <xref:System.Activities.Statements.CompensableActivity> 的正文中，将和值设置为现有和值与 7 以及输出结果的和值。</span><span class="sxs-lookup"><span data-stu-id="0e060-128">In the body of the second <xref:System.Activities.Statements.CompensableActivity>, the sum is set to the sum of the existing sum and 7 and the result printed.</span></span> <span data-ttu-id="0e060-129">为第一个 <xref:System.Activities.Statements.CompensableActivity> 定义一个自定义确认处理程序，此处理程序将输出和值、减去 7，然后重新输出和值。</span><span class="sxs-lookup"><span data-stu-id="0e060-129">A custom confirmation handler is defined for the first <xref:System.Activities.Statements.CompensableActivity>, which prints the sum, subtracts 7 and prints the sum again.</span></span> <span data-ttu-id="0e060-130">通过检查输出的和值，可以很清楚地知道，该变量不仅位于两个 <xref:System.Activities.Statements.CompensableActivity> 的正文范围内，而且还位于 <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> 的正文范围内。</span><span class="sxs-lookup"><span data-stu-id="0e060-130">It is clear by inspecting the printed sums that the variable is in scope not only for the bodies of both <xref:System.Activities.Statements.CompensableActivity> but the <xref:System.Activities.Statements.CompensableActivity.ConfirmationHandler%2A> as well.</span></span>  
  
#### <a name="to-run-the-sample"></a><span data-ttu-id="0e060-131">运行示例</span><span class="sxs-lookup"><span data-stu-id="0e060-131">To run the sample</span></span>  
  
1.  <span data-ttu-id="0e060-132">在 [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] 中加载解决方案。</span><span class="sxs-lookup"><span data-stu-id="0e060-132">Load the solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="0e060-133">运行 ConfirmationSample.exe 应用程序。</span><span class="sxs-lookup"><span data-stu-id="0e060-133">Run the ConfirmationSample.exe application.</span></span>  
  
3.  <span data-ttu-id="0e060-134">观察以下输出：</span><span class="sxs-lookup"><span data-stu-id="0e060-134">Observe the following output:</span></span>  
  
 <span data-ttu-id="0e060-135">**显式确认： Start workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1： 确认 HandlerEnd 的 workflowCompensableActivity2： 确认 HandlerExplicit 补偿： StartworkflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: workflowCompensableActivity2 的补偿 HandlerEnd： 确认 HandlerCustom 确认处理程序： Start workflowCompensableActivity1 的：BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd workflowCompensableActivity1： 确认 HandlerCompensableActivity2： 确认 HandlerCompensableActivity3： 确认 HandlerVariable 中确认处理程序的访问权限：开始 workflowCompensableActivity1: BodyCompensableActivity1： 之和： 15CompensableActivity2: BodyCompensableActivity2： 到 sumCompensableActivity2 添加 7： 现在之和： 22End workflowCompensableActivity2： 确认HandlerCompensableActivity1： 确认 HandlerCompensableActivity2： 之和： 22CompensableActivity2： 减去 12 后之现在： 10Press ENTER 退出。**</span><span class="sxs-lookup"><span data-stu-id="0e060-135">**Explicit confirmation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Confirmation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerExplicit compensation:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity1: Compensation HandlerEnd of workflowCompensableActivity2: Confirmation HandlerCustom confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity2: BodyCompensableActivity3: BodyEnd of workflowCompensableActivity1: Confirmation HandlerCompensableActivity2: Confirmation HandlerCompensableActivity3: Confirmation HandlerVariable access in a confirmation handler:Start of workflowCompensableActivity1: BodyCompensableActivity1: The sum is: 15CompensableActivity2: BodyCompensableActivity2: Adding 7 to the sumCompensableActivity2: The sum is now: 22End of workflowCompensableActivity2: Confirmation HandlerCompensableActivity1: Confirmation HandlerCompensableActivity2: The sum is: 22CompensableActivity2: After subtracting 12 the sum is now: 10Press ENTER to exit.**</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="0e060-136">您的计算机上可能已安装这些示例。</span><span class="sxs-lookup"><span data-stu-id="0e060-136">The samples may already be installed on your machine.</span></span> <span data-ttu-id="0e060-137">在继续操作之前，请先检查以下（默认）目录：</span><span class="sxs-lookup"><span data-stu-id="0e060-137">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="0e060-138">如果此目录不存在，请转到[Windows Communication Foundation (WCF) 和.NET Framework 4 的 Windows Workflow Foundation (WF) 示例](https://go.microsoft.com/fwlink/?LinkId=150780)若要下载所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]示例。</span><span class="sxs-lookup"><span data-stu-id="0e060-138">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="0e060-139">此示例位于以下目录：</span><span class="sxs-lookup"><span data-stu-id="0e060-139">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Compensation\Confirmation`