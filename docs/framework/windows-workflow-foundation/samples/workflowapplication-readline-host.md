---
title: WorkflowApplication ReadLine 主机
ms.date: 03/30/2017
ms.assetid: f7b362be-cb42-40d7-b9ef-cfc4aed2455b
ms.openlocfilehash: 8da8a5bb4c80a86fe5ae9e133ea545c00ee17fba
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/04/2018
ms.locfileid: "33518533"
---
# <a name="workflowapplication-readline-host"></a><span data-ttu-id="b551b-102">WorkflowApplication ReadLine 主机</span><span class="sxs-lookup"><span data-stu-id="b551b-102">WorkflowApplication ReadLine Host</span></span>
<span data-ttu-id="b551b-103">此示例是一个泛型 ReadLine 主机。</span><span class="sxs-lookup"><span data-stu-id="b551b-103">This sample is a generic ReadLine host.</span></span> <span data-ttu-id="b551b-104">可以使用包含的 `ReadLine` 活动（或是从通过字符串恢复的书签获取数据的其他类似活动）来加载和运行任何工作流。</span><span class="sxs-lookup"><span data-stu-id="b551b-104">You can load and run any workflow using the included `ReadLine` activity (or other activities like it that get data from bookmarks resumed with strings).</span></span> <span data-ttu-id="b551b-105">`WriteLine` 活动的输出或写入 <xref:System.Activities.Statements.WriteLine.TextWriter%2A> 扩展的任何内容会定向到主机窗口。</span><span class="sxs-lookup"><span data-stu-id="b551b-105">Output from the `WriteLine` activity or anything writing to the <xref:System.Activities.Statements.WriteLine.TextWriter%2A> extension is directed to the host window.</span></span> <span data-ttu-id="b551b-106">当某个实例处于空闲状态时，该实例的可用书签会出现在一个组合框中。</span><span class="sxs-lookup"><span data-stu-id="b551b-106">When an instance is idle, the available bookmarks for that instance appear in a combo box.</span></span> <span data-ttu-id="b551b-107">选择书签、输入某些文本和按恢复书签按钮都会继续执行工作流。</span><span class="sxs-lookup"><span data-stu-id="b551b-107">Selecting a bookmark, inputting some text, and pressing the resume bookmark button continue the execution of the workflow.</span></span> <span data-ttu-id="b551b-108">也可以取消、中止或终止选择的工作流。</span><span class="sxs-lookup"><span data-stu-id="b551b-108">You can also cancel, abort, or terminate a selected workflow.</span></span> <span data-ttu-id="b551b-109">默认情况下持久性处于启用状态 - 您可以关闭主机，然后将其重新打开，实例列表会被那些存储在数据库中的实例所填充。</span><span class="sxs-lookup"><span data-stu-id="b551b-109">Persistence is on by default – you can shut down the host and bring it back, and the instance list is populated with the instances stored in the database.</span></span> <span data-ttu-id="b551b-110">跟踪可用于将 <xref:System.Activities.WorkflowApplication> 级别事件输出到主机（可以选择在活动级别添加详细跟踪）。</span><span class="sxs-lookup"><span data-stu-id="b551b-110">Tracking is used to output <xref:System.Activities.WorkflowApplication>-level events to the host with the option to add detailed tracking at the activity level.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="b551b-111">示例详细信息</span><span class="sxs-lookup"><span data-stu-id="b551b-111">Sample Details</span></span>  
 <span data-ttu-id="b551b-112">此主机有两层：视图和实例管理器。</span><span class="sxs-lookup"><span data-stu-id="b551b-112">There are two layers to this host: the view and the instance manager.</span></span> <span data-ttu-id="b551b-113">视图由 `HostView` 和 `WorkflowApplicationInfo` 类组成。</span><span class="sxs-lookup"><span data-stu-id="b551b-113">The view consists of the `HostView` and `WorkflowApplicationInfo` classes.</span></span> <span data-ttu-id="b551b-114">此主机的常规模式针对 `HostView` 类，以便基于 `WorkflowApplicationInfo` 对象向用户显示可用选项，这些对象与其所表示的实例保持合理同步。</span><span class="sxs-lookup"><span data-stu-id="b551b-114">The general pattern for this host is for the `HostView` class to display available options to the user based on `WorkflowApplicationInfo` objects that are kept reasonably in synchronization with the instances they represent.</span></span> <span data-ttu-id="b551b-115">实例管理器层由 `WorkflowApplicationManager` 类（所有主机通信的核心）和 `WorkflowDefinitionExtension` 类（保留实例与用于启动实例的程序定义之间的关系，以及一些其他类）。</span><span class="sxs-lookup"><span data-stu-id="b551b-115">The instance manager layer consists of the `WorkflowApplicationManager` class, which is the core of all host communications, and the `WorkflowDefinitionExtension` class, which persists the relationship between an instance and the program definition it was started with and a few other classes.</span></span> <span data-ttu-id="b551b-116">`HostView` 调用控制 `WorkflowApplicationManager` 上的操作。</span><span class="sxs-lookup"><span data-stu-id="b551b-116">The `HostView` calls control operations on the `WorkflowApplicationManager`.</span></span> <span data-ttu-id="b551b-117">这些调用通常是异步的，以维持具有响应能力的用户界面。</span><span class="sxs-lookup"><span data-stu-id="b551b-117">These calls are typically asynchronous to maintain a responsive user interface.</span></span> <span data-ttu-id="b551b-118">这些异步调用完成时，`WorkflowApplicationManager` 通过一个定义完善的界面 (`IHostView`) 回调到视图层中。</span><span class="sxs-lookup"><span data-stu-id="b551b-118">When the asynchronous calls complete, the `WorkflowApplicationManager` makes calls back into the view layer through a well-defined interface (`IHostView`).</span></span> <span data-ttu-id="b551b-119">`HostView` 类通常将这些调用从 `WorkflowApplicationManager` 类调度到用户界面线程。</span><span class="sxs-lookup"><span data-stu-id="b551b-119">The `HostView` class most often dispatches these calls from the `WorkflowApplicationManager` class to the user interface thread.</span></span> <span data-ttu-id="b551b-120">将向由 <xref:System.Activities.Statements.WriteLine.TextWriter%2A> 类提供的线程安全 `HostView` 对象写入文本。</span><span class="sxs-lookup"><span data-stu-id="b551b-120">Text writing is done to thread-safe <xref:System.Activities.Statements.WriteLine.TextWriter%2A> objects provided by the `HostView` class.</span></span> <span data-ttu-id="b551b-121">不只是用户界面生成事件。</span><span class="sxs-lookup"><span data-stu-id="b551b-121">The user interface is not the only thing generating events.</span></span> <span data-ttu-id="b551b-122">例如，当 <xref:System.Activities.WorkflowApplication> 对象转为 `WorkflowApplicationManager`、`Idle` 或 `Complete` 时，也会向 `Aborted` 发出信号。</span><span class="sxs-lookup"><span data-stu-id="b551b-122">The <xref:System.Activities.WorkflowApplication> objects also signal the `WorkflowApplicationManager` when they go `Idle`, `Complete`, or are `Aborted`, for example.</span></span> <span data-ttu-id="b551b-123">`WorkflowApplicationManager` 类通过将清理或更新工作调度到主机来脱离事件线程。</span><span class="sxs-lookup"><span data-stu-id="b551b-123">The `WorkflowApplicationManager` class gets off the event thread by dispatching clean up or updating work to the host.</span></span>  
  
 <span data-ttu-id="b551b-124">通过 <xref:System.Activities.WorkflowApplication> 类可帮助对用于启动 `WorkflowDefinitionExtension` 的文件进行记录。</span><span class="sxs-lookup"><span data-stu-id="b551b-124">The recording of the file used to launch a <xref:System.Activities.WorkflowApplication> is facilitated by the `WorkflowDefinitionExtension` class.</span></span> <span data-ttu-id="b551b-125">该类实现 <xref:System.Activities.Persistence.PersistenceIOParticipant> 接口以参与持久性并将路径保留至工作流定义。</span><span class="sxs-lookup"><span data-stu-id="b551b-125">It implements the <xref:System.Activities.Persistence.PersistenceIOParticipant> interface to participate in persistence and persist the path to the workflow definition.</span></span>  
  
 <span data-ttu-id="b551b-126">`WorkflowApplicationManager.Load` 方法使用存储的路径来实例化加载未完成 <xref:System.Activities.WorkflowApplication> 对象所需的工作流程序。</span><span class="sxs-lookup"><span data-stu-id="b551b-126">The `WorkflowApplicationManager.Load` method uses the stored path to instantiate the workflow programs required for loading unfinished <xref:System.Activities.WorkflowApplication> objects.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="b551b-127">设置、生成和运行示例</span><span class="sxs-lookup"><span data-stu-id="b551b-127">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="b551b-128">此示例要求安装 SQL Express。</span><span class="sxs-lookup"><span data-stu-id="b551b-128">This sample requires SQL Express to be installed.</span></span> <span data-ttu-id="b551b-129">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] 附带有 SQL Express。</span><span class="sxs-lookup"><span data-stu-id="b551b-129">SQL Express comes with [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="b551b-130">打开 Visual Studio 2010 命令提示符。</span><span class="sxs-lookup"><span data-stu-id="b551b-130">Open a Visual Studio 2010 command prompt.</span></span>  
  
3.  <span data-ttu-id="b551b-131">导航到示例目录 (\WF\Basic\Execution\ControllingWorkflowApplications)，然后运行 CreateInstanceStore.cmd。</span><span class="sxs-lookup"><span data-stu-id="b551b-131">Navigate to the sample directory (\WF\Basic\Execution\ControllingWorkflowApplications) and run CreateInstanceStore.cmd.</span></span>  
  
4.  <span data-ttu-id="b551b-132">CreateInstanceStore.cmd 脚本尝试在 SQL Server 2008 Express 的默认实例上创建数据库。</span><span class="sxs-lookup"><span data-stu-id="b551b-132">The CreateInstanceStore.cmd script attempts to create the database on the default instance of SQL Server 2008 Express.</span></span> <span data-ttu-id="b551b-133">如果要在不同的实例上安装数据库，请修改脚本。</span><span class="sxs-lookup"><span data-stu-id="b551b-133">If you want to install the database on a different instance, modify the script to do so.</span></span>  
  
5.  <span data-ttu-id="b551b-134">编译 WorkflowApplicationReadLineHost 项目，然后从命令行运行该项目。</span><span class="sxs-lookup"><span data-stu-id="b551b-134">Compile the WorkflowApplicationReadLineHost project and run it from the command line.</span></span>  
  
6.  <span data-ttu-id="b551b-135">一旦运行，便可以选择关闭或打开持久性。</span><span class="sxs-lookup"><span data-stu-id="b551b-135">Once running, you can optionally turn persistence off or on.</span></span> <span data-ttu-id="b551b-136">另外，也可以选择打开或关闭详细活动跟踪。</span><span class="sxs-lookup"><span data-stu-id="b551b-136">Further, you can optionally turn detailed activity tracking on or off.</span></span>  
  
7.  <span data-ttu-id="b551b-137">按旁边的省略号按钮**运行**按钮以浏览 XAML 文件中定义的工作流</span><span class="sxs-lookup"><span data-stu-id="b551b-137">Press the ellipsis button next to the **Run** button to browse for a workflow defined in a XAML file</span></span>  
  
     <span data-ttu-id="b551b-138">SampleWorkflows 文件夹下面有两个示例。</span><span class="sxs-lookup"><span data-stu-id="b551b-138">Two samples can be found under the SampleWorkflows folder.</span></span> <span data-ttu-id="b551b-139">parallel1.xaml 示例进入空闲状态。</span><span class="sxs-lookup"><span data-stu-id="b551b-139">The parallel1.xaml example goes idle.</span></span>  
  
8.  <span data-ttu-id="b551b-140">选择示例后，按**运行**按钮。</span><span class="sxs-lookup"><span data-stu-id="b551b-140">Once an example is selected, press the **Run** button.</span></span>  
  
9. <span data-ttu-id="b551b-141">如果或当工作流进入空闲状态时、**书签**组合框填充有可用书签。</span><span class="sxs-lookup"><span data-stu-id="b551b-141">If or when the workflow goes idle, the **Bookmarks** combo box is populated with available bookmarks.</span></span>  
  
10. <span data-ttu-id="b551b-142">此时的选项可用于恢复书签以及取消、中止或终止工作流。</span><span class="sxs-lookup"><span data-stu-id="b551b-142">The options at this point are to resume a bookmark, cancel, abort, or terminate the workflow.</span></span> <span data-ttu-id="b551b-143">也可以关闭主机然后重新启动。</span><span class="sxs-lookup"><span data-stu-id="b551b-143">You can also shut down the host and restart it.</span></span> <span data-ttu-id="b551b-144">如果持久性保留为打开，则会在关机时卸载实例，并在启动时重新加载。</span><span class="sxs-lookup"><span data-stu-id="b551b-144">If persistence is left on, the instances are unloaded on shutdown and reloaded on start up.</span></span>  
  
     <span data-ttu-id="b551b-145">若要恢复书签，选择所需的书签，组合框和按旁边的文本框中输入值**恢复书签**。</span><span class="sxs-lookup"><span data-stu-id="b551b-145">To resume a bookmark, select the desired bookmark, type in a value in the text box next to the combo box and press **Resume Bookmark**.</span></span>  
  
#### <a name="to-remove-the-instance-store-database"></a><span data-ttu-id="b551b-146">删除实例存储区数据库</span><span class="sxs-lookup"><span data-stu-id="b551b-146">To remove the instance store database</span></span>  
  
1.  <span data-ttu-id="b551b-147">打开 Visual Studio 2010 命令提示符。</span><span class="sxs-lookup"><span data-stu-id="b551b-147">Open a Visual Studio 2010 command prompt.</span></span>  
  
2.  <span data-ttu-id="b551b-148">导航到示例目录 (\WF\Basic\Execution\ControllingWorkflowApplications)，然后运行 RemoveInstanceStore.cmd。</span><span class="sxs-lookup"><span data-stu-id="b551b-148">Navigate to the sample directory (\WF\Basic\Execution\ControllingWorkflowApplications) and run RemoveInstanceStore.cmd.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="b551b-149">您的计算机上可能已安装这些示例。</span><span class="sxs-lookup"><span data-stu-id="b551b-149">The samples may already be installed on your machine.</span></span> <span data-ttu-id="b551b-150">在继续操作之前，请先检查以下（默认）目录：</span><span class="sxs-lookup"><span data-stu-id="b551b-150">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="b551b-151">如果此目录不存在，请转到[Windows Communication Foundation (WCF) 和针对.NET Framework 4 的 Windows Workflow Foundation (WF) 示例](http://go.microsoft.com/fwlink/?LinkId=150780)下载所有 Windows Communication Foundation (WCF) 和[!INCLUDE[wf1](../../../../includes/wf1-md.md)]示例。</span><span class="sxs-lookup"><span data-stu-id="b551b-151">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="b551b-152">此示例位于以下目录：</span><span class="sxs-lookup"><span data-stu-id="b551b-152">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Execution\ControllingWorkflowApplications`