---
title: Declare Statement
ms.date: 07/20/2015
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: devlang-visual-basic
ms.topic: article
f1_keywords:
- vb.Declare
- vb.Lib
- vb.Any
helpviewer_keywords:
- Lib keyword [Visual Basic]
- declaring procedures [Visual Basic], Declare statement
- functions [Visual Basic], function procedures
- declarations [Visual Basic], procedures
- procedures [Visual Basic], declaration
- procedures [Visual Basic], external
- Alias keyword [Visual Basic]
- external references [Visual Basic], Visual Basic
- DLLs, declaring procedures
- Declare statement [Visual Basic]
- declarations [Visual Basic], external
- Visual Basic code, Function procedures
- As keyword [Visual Basic], in Declare statement
- resources [Visual Basic], declaring
- Public keyword [Visual Basic], Declare statement
- platform invoke, Visual Basic external references
- Sub procedures [Visual Basic], declarations
- APIs, declaring API functions
- Visual Basic code, Sub procedures
- Function procedures [Visual Basic], declaring
ms.assetid: d3f21fb0-b804-4c99-97ed-583b23894cf1
caps.latest.revision: "30"
author: dotnet-bot
ms.author: dotnetcontent
ms.openlocfilehash: 2560f34a5130ef7453b50ffb4495b67bf1dfa4c8
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/21/2017
---
# <a name="declare-statement"></a><span data-ttu-id="50d82-102">Declare Statement</span><span class="sxs-lookup"><span data-stu-id="50d82-102">Declare Statement</span></span>
<span data-ttu-id="50d82-103">声明对外部文件中实现的过程的引用。</span><span class="sxs-lookup"><span data-stu-id="50d82-103">Declares a reference to a procedure implemented in an external file.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="50d82-104">语法</span><span class="sxs-lookup"><span data-stu-id="50d82-104">Syntax</span></span>  
  
```  
[ <attributelist> ] [ accessmodifier ] [ Shadows ] [ Overloads ] _  
Declare [ charsetmodifier ] [ Sub ] name Lib "libname" _  
[ Alias "aliasname" ] [ ([ parameterlist ]) ]  
' -or-  
[ <attributelist> ] [ accessmodifier ] [ Shadows ] [ Overloads ] _  
Declare [ charsetmodifier ] [ Function ] name Lib "libname" _  
[ Alias "aliasname" ] [ ([ parameterlist ]) ] [ As returntype ]  
```  
  
## <a name="parts"></a><span data-ttu-id="50d82-105">部件</span><span class="sxs-lookup"><span data-stu-id="50d82-105">Parts</span></span>  
  
|<span data-ttu-id="50d82-106">术语</span><span class="sxs-lookup"><span data-stu-id="50d82-106">Term</span></span>|<span data-ttu-id="50d82-107">定义</span><span class="sxs-lookup"><span data-stu-id="50d82-107">Definition</span></span>|  
|---|---|  
|`attributelist`|<span data-ttu-id="50d82-108">可选。</span><span class="sxs-lookup"><span data-stu-id="50d82-108">Optional.</span></span> <span data-ttu-id="50d82-109">请参阅[属性列表](../../../visual-basic/language-reference/statements/attribute-list.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-109">See [Attribute List](../../../visual-basic/language-reference/statements/attribute-list.md).</span></span>|  
|`accessmodifier`|<span data-ttu-id="50d82-110">可选。</span><span class="sxs-lookup"><span data-stu-id="50d82-110">Optional.</span></span> <span data-ttu-id="50d82-111">可以是以下各项之一：</span><span class="sxs-lookup"><span data-stu-id="50d82-111">Can be one of the following:</span></span><br /><br /> <span data-ttu-id="50d82-112">-   [公共](../../../visual-basic/language-reference/modifiers/public.md)</span><span class="sxs-lookup"><span data-stu-id="50d82-112">-   [Public](../../../visual-basic/language-reference/modifiers/public.md)</span></span><br /><span data-ttu-id="50d82-113">-   [受保护](../../../visual-basic/language-reference/modifiers/protected.md)</span><span class="sxs-lookup"><span data-stu-id="50d82-113">-   [Protected](../../../visual-basic/language-reference/modifiers/protected.md)</span></span><br /><span data-ttu-id="50d82-114">-   [友元](../../../visual-basic/language-reference/modifiers/friend.md)</span><span class="sxs-lookup"><span data-stu-id="50d82-114">-   [Friend](../../../visual-basic/language-reference/modifiers/friend.md)</span></span><br /><span data-ttu-id="50d82-115">-   [私有](../../../visual-basic/language-reference/modifiers/private.md)</span><span class="sxs-lookup"><span data-stu-id="50d82-115">-   [Private](../../../visual-basic/language-reference/modifiers/private.md)</span></span><br />-   `Protected Friend`<br /><br /> <span data-ttu-id="50d82-116">请参阅[访问 Visual Basic 中的级别](../../../visual-basic/programming-guide/language-features/declared-elements/access-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-116">See [Access levels in Visual Basic](../../../visual-basic/programming-guide/language-features/declared-elements/access-levels.md).</span></span>|  
|`Shadows`|<span data-ttu-id="50d82-117">可选。</span><span class="sxs-lookup"><span data-stu-id="50d82-117">Optional.</span></span> <span data-ttu-id="50d82-118">请参阅[阴影](../../../visual-basic/language-reference/modifiers/shadows.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-118">See [Shadows](../../../visual-basic/language-reference/modifiers/shadows.md).</span></span>|  
|`charsetmodifier`|<span data-ttu-id="50d82-119">可选。</span><span class="sxs-lookup"><span data-stu-id="50d82-119">Optional.</span></span> <span data-ttu-id="50d82-120">指定字符集和文件搜索信息。</span><span class="sxs-lookup"><span data-stu-id="50d82-120">Specifies character set and file search information.</span></span> <span data-ttu-id="50d82-121">可以是以下各项之一：</span><span class="sxs-lookup"><span data-stu-id="50d82-121">Can be one of the following:</span></span><br /><br /> <span data-ttu-id="50d82-122">-   [Ansi](../../../visual-basic/language-reference/modifiers/ansi.md) （默认值）</span><span class="sxs-lookup"><span data-stu-id="50d82-122">-   [Ansi](../../../visual-basic/language-reference/modifiers/ansi.md) (default)</span></span><br /><span data-ttu-id="50d82-123">-   [Unicode](../../../visual-basic/language-reference/modifiers/unicode.md)</span><span class="sxs-lookup"><span data-stu-id="50d82-123">-   [Unicode](../../../visual-basic/language-reference/modifiers/unicode.md)</span></span><br /><span data-ttu-id="50d82-124">-   [自动](../../../visual-basic/language-reference/modifiers/auto.md)</span><span class="sxs-lookup"><span data-stu-id="50d82-124">-   [Auto](../../../visual-basic/language-reference/modifiers/auto.md)</span></span>|  
|`Sub`|<span data-ttu-id="50d82-125">可选，但请`Sub`或`Function`必须出现。</span><span class="sxs-lookup"><span data-stu-id="50d82-125">Optional, but either `Sub` or `Function` must appear.</span></span> <span data-ttu-id="50d82-126">指示外部过程不返回值。</span><span class="sxs-lookup"><span data-stu-id="50d82-126">Indicates that the external procedure does not return a value.</span></span>|  
|`Function`|<span data-ttu-id="50d82-127">可选，但请`Sub`或`Function`必须出现。</span><span class="sxs-lookup"><span data-stu-id="50d82-127">Optional, but either `Sub` or `Function` must appear.</span></span> <span data-ttu-id="50d82-128">指示外部过程返回一个值。</span><span class="sxs-lookup"><span data-stu-id="50d82-128">Indicates that the external procedure returns a value.</span></span>|  
|`name`|<span data-ttu-id="50d82-129">必需。</span><span class="sxs-lookup"><span data-stu-id="50d82-129">Required.</span></span> <span data-ttu-id="50d82-130">此外部引用的名称。</span><span class="sxs-lookup"><span data-stu-id="50d82-130">Name of this external reference.</span></span> <span data-ttu-id="50d82-131">有关详细信息，请参阅[声明元素名称](../../../visual-basic/programming-guide/language-features/declared-elements/declared-element-names.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-131">For more information, see [Declared Element Names](../../../visual-basic/programming-guide/language-features/declared-elements/declared-element-names.md).</span></span>|  
|`Lib`|<span data-ttu-id="50d82-132">必需。</span><span class="sxs-lookup"><span data-stu-id="50d82-132">Required.</span></span> <span data-ttu-id="50d82-133">引入了`Lib`子句，用于标识包含外部过程的外部文件 （DLL 或代码资源）。</span><span class="sxs-lookup"><span data-stu-id="50d82-133">Introduces a `Lib` clause, which identifies the external file (DLL or code resource) that contains an external procedure.</span></span>|  
|`libname`|<span data-ttu-id="50d82-134">必需。</span><span class="sxs-lookup"><span data-stu-id="50d82-134">Required.</span></span> <span data-ttu-id="50d82-135">包含声明的过程的文件的名称。</span><span class="sxs-lookup"><span data-stu-id="50d82-135">Name of the file that contains the declared procedure.</span></span>|  
|`Alias`|<span data-ttu-id="50d82-136">可选。</span><span class="sxs-lookup"><span data-stu-id="50d82-136">Optional.</span></span> <span data-ttu-id="50d82-137">指示正在声明的过程，不能由中指定的名称在其文件中将标识`name`。</span><span class="sxs-lookup"><span data-stu-id="50d82-137">Indicates that the procedure being declared cannot be identified within its file by the name specified in `name`.</span></span> <span data-ttu-id="50d82-138">指定在其标识`aliasname`。</span><span class="sxs-lookup"><span data-stu-id="50d82-138">You specify its identification in `aliasname`.</span></span>|  
|`aliasname`|<span data-ttu-id="50d82-139">如果你使用是必需的`Alias`关键字。</span><span class="sxs-lookup"><span data-stu-id="50d82-139">Required if you use the `Alias` keyword.</span></span> <span data-ttu-id="50d82-140">标识两种方式之一中的过程的字符串：</span><span class="sxs-lookup"><span data-stu-id="50d82-140">String that identifies the procedure in one of two ways:</span></span><br /><br /> <span data-ttu-id="50d82-141">在其文件中，用引号括起来的过程的入口点名称 (`""`)</span><span class="sxs-lookup"><span data-stu-id="50d82-141">The entry point name of the procedure within its file, within quotes (`""`)</span></span><br /><br /> <span data-ttu-id="50d82-142">- 或 -</span><span class="sxs-lookup"><span data-stu-id="50d82-142">-or-</span></span><br /><br /> <span data-ttu-id="50d82-143">数字符号 (`#`) 跟一个整数，指定在其文件中的过程的入口点的序号</span><span class="sxs-lookup"><span data-stu-id="50d82-143">A number sign (`#`) followed by an integer specifying the ordinal number of the procedure's entry point within its file</span></span>|  
|`parameterlist`|<span data-ttu-id="50d82-144">所需如果该过程采用参数。</span><span class="sxs-lookup"><span data-stu-id="50d82-144">Required if the procedure takes parameters.</span></span> <span data-ttu-id="50d82-145">请参阅[参数列表](../../../visual-basic/language-reference/statements/parameter-list.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-145">See [Parameter List](../../../visual-basic/language-reference/statements/parameter-list.md).</span></span>|  
|`returntype`|<span data-ttu-id="50d82-146">如果存在`Function`指定和`Option Strict`是`On`。</span><span class="sxs-lookup"><span data-stu-id="50d82-146">Required if `Function` is specified and `Option Strict` is `On`.</span></span> <span data-ttu-id="50d82-147">该过程返回的值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="50d82-147">Data type of the value returned by the procedure.</span></span>|  
  
## <a name="remarks"></a><span data-ttu-id="50d82-148">备注</span><span class="sxs-lookup"><span data-stu-id="50d82-148">Remarks</span></span>  
 <span data-ttu-id="50d82-149">有时，你需要调用在项目外部 （如 DLL 或代码资源中） 的文件中定义的过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-149">Sometimes you need to call a procedure defined in a file (such as a DLL or code resource) outside your project.</span></span> <span data-ttu-id="50d82-150">执行此操作时，Visual Basic 编译器没有正确调用该过程所需的信息，如过程所在的位置、 标识的方式，其调用的序列和返回类型和字符串字符集，它使用的访问。</span><span class="sxs-lookup"><span data-stu-id="50d82-150">When you do this, the Visual Basic compiler does not have access to the information it needs to call the procedure correctly, such as where the procedure is located, how it is identified, its calling sequence and return type, and the string character set it uses.</span></span> <span data-ttu-id="50d82-151">`Declare`语句创建对外部过程的引用，并提供这些必需的信息。</span><span class="sxs-lookup"><span data-stu-id="50d82-151">The `Declare` statement creates a reference to an external procedure and supplies this necessary information.</span></span>  
  
 <span data-ttu-id="50d82-152">只能在模块级别使用 `Declare`。</span><span class="sxs-lookup"><span data-stu-id="50d82-152">You can use `Declare` only at module level.</span></span> <span data-ttu-id="50d82-153">这意味着*声明上下文*的外部引用必须为类、 结构或模块，并且不能为源文件、 命名空间、 接口、 过程或块。</span><span class="sxs-lookup"><span data-stu-id="50d82-153">This means the *declaration context* for an external reference must be a class, structure, or module, and cannot be a source file, namespace, interface, procedure, or block.</span></span> <span data-ttu-id="50d82-154">有关详细信息，请参阅[声明上下文和默认访问级别](../../../visual-basic/language-reference/statements/declaration-contexts-and-default-access-levels.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-154">For more information, see [Declaration Contexts and Default Access Levels](../../../visual-basic/language-reference/statements/declaration-contexts-and-default-access-levels.md).</span></span>  
  
 <span data-ttu-id="50d82-155">外部引用默认为[公共](../../../visual-basic/language-reference/modifiers/public.md)访问。</span><span class="sxs-lookup"><span data-stu-id="50d82-155">External references default to [Public](../../../visual-basic/language-reference/modifiers/public.md) access.</span></span> <span data-ttu-id="50d82-156">你可以调整其访问级别有访问修饰符。</span><span class="sxs-lookup"><span data-stu-id="50d82-156">You can adjust their access levels with the access modifiers.</span></span>  
  
## <a name="rules"></a><span data-ttu-id="50d82-157">规则</span><span class="sxs-lookup"><span data-stu-id="50d82-157">Rules</span></span>  
  
-   <span data-ttu-id="50d82-158">**属性。**</span><span class="sxs-lookup"><span data-stu-id="50d82-158">**Attributes.**</span></span> <span data-ttu-id="50d82-159">可以将特性应用于的外部引用。</span><span class="sxs-lookup"><span data-stu-id="50d82-159">You can apply attributes to an external reference.</span></span> <span data-ttu-id="50d82-160">你应用的任何特性都有效，仅在你的项目中，不是外部文件中。</span><span class="sxs-lookup"><span data-stu-id="50d82-160">Any attribute you apply has effect only in your project, not in the external file.</span></span>  
  
-   <span data-ttu-id="50d82-161">**修饰符。**</span><span class="sxs-lookup"><span data-stu-id="50d82-161">**Modifiers.**</span></span> <span data-ttu-id="50d82-162">外部过程是隐式[共享](../../../visual-basic/language-reference/modifiers/shared.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-162">External procedures are implicitly [Shared](../../../visual-basic/language-reference/modifiers/shared.md).</span></span> <span data-ttu-id="50d82-163">不能使用`Shared`关键字声明的外部引用，以及你不能更改它的共享的状态时。</span><span class="sxs-lookup"><span data-stu-id="50d82-163">You cannot use the `Shared` keyword when declaring an external reference, and you cannot alter its shared status.</span></span>  
  
     <span data-ttu-id="50d82-164">外部过程不能参与重写、 实现接口成员，或处理的事件。</span><span class="sxs-lookup"><span data-stu-id="50d82-164">An external procedure cannot participate in overriding, implement interface members, or handle events.</span></span> <span data-ttu-id="50d82-165">相应地，不能使用`Overrides`， `Overridable`， `NotOverridable`， `MustOverride`， `Implements`，或`Handles`中的关键字`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="50d82-165">Accordingly, you cannot use the `Overrides`, `Overridable`, `NotOverridable`, `MustOverride`, `Implements`, or `Handles` keyword in a `Declare` statement.</span></span>  
  
-   <span data-ttu-id="50d82-166">**外部过程名称。**</span><span class="sxs-lookup"><span data-stu-id="50d82-166">**External Procedure Name.**</span></span> <span data-ttu-id="50d82-167">无需为相同的名称的此外部引用 (在`name`) 作为其外部文件中的过程的入口点名称 (`aliasname`)。</span><span class="sxs-lookup"><span data-stu-id="50d82-167">You do not have to give this external reference the same name (in `name`) as the procedure's entry-point name within its external file (`aliasname`).</span></span> <span data-ttu-id="50d82-168">你可以使用`Alias`子句来指定入口点名称。</span><span class="sxs-lookup"><span data-stu-id="50d82-168">You can use an `Alias` clause to specify the entry-point name.</span></span> <span data-ttu-id="50d82-169">这可以是外部的过程相同的作用域中具有同名 Visual Basic 保留的修饰符或变量、 过程或其他任何编程元素的情况下很有用。</span><span class="sxs-lookup"><span data-stu-id="50d82-169">This can be useful if the external procedure has the same name as a Visual Basic reserved modifier or a variable, procedure, or any other programming element in the same scope.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="50d82-170">大多数 Dll 中的入口点名称都区分大小写。</span><span class="sxs-lookup"><span data-stu-id="50d82-170">Entry-point names in most DLLs are case-sensitive.</span></span>  
  
-   <span data-ttu-id="50d82-171">**外部过程数。**</span><span class="sxs-lookup"><span data-stu-id="50d82-171">**External Procedure Number.**</span></span> <span data-ttu-id="50d82-172">或者，可以使用`Alias`子句来指定外部文件的导出表内的入口点的序号。</span><span class="sxs-lookup"><span data-stu-id="50d82-172">Alternatively, you can use an `Alias` clause to specify the ordinal number of the entry point within the export table of the external file.</span></span> <span data-ttu-id="50d82-173">若要执行此操作，开始时`aliasname`数字符号 (`#`)。</span><span class="sxs-lookup"><span data-stu-id="50d82-173">To do this, you begin `aliasname` with a number sign (`#`).</span></span> <span data-ttu-id="50d82-174">如果外部过程名称中的任何字符不允许在 Visual Basic 中，或如果外部文件导出没有名称的过程，这可能很有用。</span><span class="sxs-lookup"><span data-stu-id="50d82-174">This can be useful if any character in the external procedure name is not allowed in Visual Basic, or if the external file exports the procedure without a name.</span></span>  
  
## <a name="data-type-rules"></a><span data-ttu-id="50d82-175">数据类型规则</span><span class="sxs-lookup"><span data-stu-id="50d82-175">Data Type Rules</span></span>  
  
-   <span data-ttu-id="50d82-176">**参数数据类型。**</span><span class="sxs-lookup"><span data-stu-id="50d82-176">**Parameter Data Types.**</span></span> <span data-ttu-id="50d82-177">如果`Option Strict`是`On`，必须指定在每个参数的数据类型`parameterlist`。</span><span class="sxs-lookup"><span data-stu-id="50d82-177">If `Option Strict` is `On`, you must specify the data type of each parameter in `parameterlist`.</span></span> <span data-ttu-id="50d82-178">这可以是任何数据类型或枚举、 结构、 类或接口的名称。</span><span class="sxs-lookup"><span data-stu-id="50d82-178">This can be any data type or the name of an enumeration, structure, class, or interface.</span></span> <span data-ttu-id="50d82-179">在`parameterlist`，你使用`As`子句，以指定要传递给每个参数的自变量的数据类型。</span><span class="sxs-lookup"><span data-stu-id="50d82-179">Within `parameterlist`, you use an `As` clause to specify the data type of the argument to be passed to each parameter.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="50d82-180">如果不是外部过程已为.NET Framework 编写，您必须采取措施的数据类型相对应。</span><span class="sxs-lookup"><span data-stu-id="50d82-180">If the external procedure was not written for the .NET Framework, you must take care that the data types correspond.</span></span> <span data-ttu-id="50d82-181">例如，如果声明对使用为 Visual Basic 6.0 过程的外部引用`Integer`参数 （在 Visual Basic 6.0 中为 16 位），你必须确定相应的自变量作为`Short`中`Declare`语句，因为这是 16 位在 Visual Basic 中的位整数类型。</span><span class="sxs-lookup"><span data-stu-id="50d82-181">For example, if you declare an external reference to a Visual Basic 6.0 procedure with an `Integer` parameter (16 bits in Visual Basic 6.0), you must identify the corresponding argument as `Short` in the `Declare` statement, because that is the 16-bit integer type in Visual Basic.</span></span> <span data-ttu-id="50d82-182">同样，`Long`在 Visual Basic 6.0 中，具有不同数据宽度和`Date`实现方式有所不同。</span><span class="sxs-lookup"><span data-stu-id="50d82-182">Similarly, `Long` has a different data width in Visual Basic 6.0, and `Date` is implemented differently.</span></span>  
  
-   <span data-ttu-id="50d82-183">**返回数据类型。**</span><span class="sxs-lookup"><span data-stu-id="50d82-183">**Return Data Type.**</span></span> <span data-ttu-id="50d82-184">如果外部过程是`Function`和`Option Strict`是`On`，必须指定返回到调用代码的值的数据类型。</span><span class="sxs-lookup"><span data-stu-id="50d82-184">If the external procedure is a `Function` and `Option Strict` is `On`, you must specify the data type of the value returned to the calling code.</span></span> <span data-ttu-id="50d82-185">这可以是任何数据类型或枚举、 结构、 类或接口的名称。</span><span class="sxs-lookup"><span data-stu-id="50d82-185">This can be any data type or the name of an enumeration, structure, class, or interface.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="50d82-186">Visual Basic 编译器不验证您的数据类型与外部过程的这些兼容。</span><span class="sxs-lookup"><span data-stu-id="50d82-186">The Visual Basic compiler does not verify that your data types are compatible with those of the external procedure.</span></span> <span data-ttu-id="50d82-187">如果存在不匹配，公共语言运行时生成<xref:System.Runtime.InteropServices.MarshalDirectiveException>运行时异常。</span><span class="sxs-lookup"><span data-stu-id="50d82-187">If there is a mismatch, the common language runtime generates a <xref:System.Runtime.InteropServices.MarshalDirectiveException> exception at run time.</span></span>  
  
-   <span data-ttu-id="50d82-188">**默认数据类型。**</span><span class="sxs-lookup"><span data-stu-id="50d82-188">**Default Data Types.**</span></span> <span data-ttu-id="50d82-189">如果`Option Strict`是`Off`，而且你不指定中的参数的数据类型`parameterlist`，Visual Basic 编译器将转换为相应的自变量[Object 数据类型](../../../visual-basic/language-reference/data-types/object-data-type.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-189">If `Option Strict` is `Off` and you do not specify the data type of a parameter in `parameterlist`, the Visual Basic compiler converts the corresponding argument to the [Object Data Type](../../../visual-basic/language-reference/data-types/object-data-type.md).</span></span> <span data-ttu-id="50d82-190">同样，如果不指定`returntype`，编译器采用要返回的数据类型`Object`。</span><span class="sxs-lookup"><span data-stu-id="50d82-190">Similarly, if you do not specify `returntype`, the compiler takes the return data type to be `Object`.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="50d82-191">因为处理可能在不同平台写入外部过程时，这很危险要进行任何假设数据类型或要允许它们采用默认设置。</span><span class="sxs-lookup"><span data-stu-id="50d82-191">Because you are dealing with an external procedure that might have been written on a different platform, it is dangerous to make any assumptions about data types or to allow them to default.</span></span> <span data-ttu-id="50d82-192">如果有的话，它会以指定数据类型的每个参数和返回值，安全很多。</span><span class="sxs-lookup"><span data-stu-id="50d82-192">It is much safer to specify the data type of every parameter and of the return value, if any.</span></span> <span data-ttu-id="50d82-193">这还可以提高代码的可读性。</span><span class="sxs-lookup"><span data-stu-id="50d82-193">This also improves the readability of your code.</span></span>  
  
## <a name="behavior"></a><span data-ttu-id="50d82-194">行为</span><span class="sxs-lookup"><span data-stu-id="50d82-194">Behavior</span></span>  
  
-   <span data-ttu-id="50d82-195">**作用域。**</span><span class="sxs-lookup"><span data-stu-id="50d82-195">**Scope.**</span></span> <span data-ttu-id="50d82-196">外部引用是在其类、 结构或模块整个范围内。</span><span class="sxs-lookup"><span data-stu-id="50d82-196">An external reference is in scope throughout its class, structure, or module.</span></span>  
  
-   <span data-ttu-id="50d82-197">**生存期。**</span><span class="sxs-lookup"><span data-stu-id="50d82-197">**Lifetime.**</span></span> <span data-ttu-id="50d82-198">外部引用具有相同的生存期类、 结构或在其中声明的模块。</span><span class="sxs-lookup"><span data-stu-id="50d82-198">An external reference has the same lifetime as the class, structure, or module in which it is declared.</span></span>  
  
-   <span data-ttu-id="50d82-199">**调用外部过程。**</span><span class="sxs-lookup"><span data-stu-id="50d82-199">**Calling an External Procedure.**</span></span> <span data-ttu-id="50d82-200">调用外部过程调用的相同方式`Function`或`Sub`过程 — 通过在表达式中使用它，如果它返回一个值，或指定在[Call 语句](../../../visual-basic/language-reference/statements/call-statement.md)如果它不返回值。</span><span class="sxs-lookup"><span data-stu-id="50d82-200">You call an external procedure the same way you call a `Function` or `Sub` procedure—by using it in an expression if it returns a value, or by specifying it in a [Call Statement](../../../visual-basic/language-reference/statements/call-statement.md) if it does not return a value.</span></span>  
  
     <span data-ttu-id="50d82-201">将自变量传递给完全按照指定的外部过程`parameterlist`中`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="50d82-201">You pass arguments to the external procedure exactly as specified by `parameterlist` in the `Declare` statement.</span></span> <span data-ttu-id="50d82-202">不会考虑外部文件中最初声明这些参数已如何。</span><span class="sxs-lookup"><span data-stu-id="50d82-202">Do not take into account how the parameters were originally declared in the external file.</span></span> <span data-ttu-id="50d82-203">同样，如果没有返回值，将其完全用作指定的`returntype`中`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="50d82-203">Similarly, if there is a return value, use it exactly as specified by `returntype` in the `Declare` statement.</span></span>  
  
-   <span data-ttu-id="50d82-204">**字符集。**</span><span class="sxs-lookup"><span data-stu-id="50d82-204">**Character Sets.**</span></span> <span data-ttu-id="50d82-205">你可以指定在`charsetmodifier`如何 Visual Basic 应封送字符串时它调用外部过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-205">You can specify in `charsetmodifier` how Visual Basic should marshal strings when it calls the external procedure.</span></span> <span data-ttu-id="50d82-206">`Ansi`修饰符将定向 Visual Basic 进行封送处理所有字符串转换为 ANSI 值和`Unicode`修饰符将其封送所有字符串转换为 Unicode 值。</span><span class="sxs-lookup"><span data-stu-id="50d82-206">The `Ansi` modifier directs Visual Basic to marshal all strings to ANSI values, and the `Unicode` modifier directs it to marshal all strings to Unicode values.</span></span> <span data-ttu-id="50d82-207">`Auto`修饰符将定向到封送字符串根据.NET Framework 的 Visual Basic 规则基于外部引用`name`，或`aliasname`如果指定。</span><span class="sxs-lookup"><span data-stu-id="50d82-207">The `Auto` modifier directs Visual Basic to marshal strings according to .NET Framework rules based on the external reference `name`, or `aliasname` if specified.</span></span> <span data-ttu-id="50d82-208">默认值为 `Ansi`。</span><span class="sxs-lookup"><span data-stu-id="50d82-208">The default value is `Ansi`.</span></span>  
  
     <span data-ttu-id="50d82-209">`charsetmodifier`此外可以指定 Visual Basic 应如何查找其外部文件中的外部过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-209">`charsetmodifier` also specifies how Visual Basic should look up the external procedure within its external file.</span></span> <span data-ttu-id="50d82-210">`Ansi`和`Unicode`同时直接 Visual Basic，而无需在搜索过程中修改其名称进行查找。</span><span class="sxs-lookup"><span data-stu-id="50d82-210">`Ansi` and `Unicode` both direct Visual Basic to look it up without modifying its name during the search.</span></span> <span data-ttu-id="50d82-211">`Auto`指示 Visual Basic 来确定运行时平台的基本字符集并可能修改外部过程名称，如下所示：</span><span class="sxs-lookup"><span data-stu-id="50d82-211">`Auto` directs Visual Basic to determine the base character set of the run-time platform and possibly modify the external procedure name, as follows:</span></span>  
  
    -   <span data-ttu-id="50d82-212">在 ANSI 平台，如 Windows 95、 Windows 98 或 Windows Millennium Edition 上首先查找带有任何名称修改的外部过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-212">On an ANSI platform, such as Windows 95, Windows 98, or Windows Millennium Edition, first look up the external procedure with no name modification.</span></span> <span data-ttu-id="50d82-213">如果失败，外部过程名称末尾追加"A"，并再次查找。</span><span class="sxs-lookup"><span data-stu-id="50d82-213">If that fails, append "A" to the end of the external procedure name and look it up again.</span></span>  
  
    -   <span data-ttu-id="50d82-214">在 Unicode 平台上，例如 Windows NT、 Windows 2000 或 Windows XP 中，首先查找带有任何名称修改的外部过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-214">On a Unicode platform, such as Windows NT, Windows 2000, or Windows XP, first look up the external procedure with no name modification.</span></span> <span data-ttu-id="50d82-215">如果失败，则追加"W"到末尾外部过程的名称，并再次查找。</span><span class="sxs-lookup"><span data-stu-id="50d82-215">If that fails, append "W" to the end of the external procedure name and look it up again.</span></span>  
  
-   <span data-ttu-id="50d82-216">**机制。**</span><span class="sxs-lookup"><span data-stu-id="50d82-216">**Mechanism.**</span></span> <span data-ttu-id="50d82-217">Visual Basic 使用.NET Framework*平台调用*(PInvoke) 机制来解析和访问外部过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-217">Visual Basic uses the .NET Framework *platform invoke* (PInvoke) mechanism to resolve and access external procedures.</span></span> <span data-ttu-id="50d82-218">`Declare`语句和<xref:System.Runtime.InteropServices.DllImportAttribute>这两个类自动使用此机制，并不需要知道 PInvoke。</span><span class="sxs-lookup"><span data-stu-id="50d82-218">The `Declare` statement and the <xref:System.Runtime.InteropServices.DllImportAttribute> class both use this mechanism automatically, and you do not need any knowledge of PInvoke.</span></span> <span data-ttu-id="50d82-219">有关详细信息，请参阅[演练： 调用 Windows Api](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-219">For more information, see [Walkthrough: Calling Windows APIs](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md).</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="50d82-220">如果外部过程外部公共语言运行时 (CLR) 运行，则*非托管代码*。</span><span class="sxs-lookup"><span data-stu-id="50d82-220">If the external procedure runs outside the common language runtime (CLR), it is *unmanaged code*.</span></span> <span data-ttu-id="50d82-221">在调用此类过程，例如 Win32 API 函数或 COM 方法，则可能会公开应用程序以便对安全风险。</span><span class="sxs-lookup"><span data-stu-id="50d82-221">When you call such a procedure, for example a Win32 API function or a COM method, you might expose your application to security risks.</span></span> <span data-ttu-id="50d82-222">有关详细信息，请参阅[非托管代码的安全编码准则](../../../framework/security/secure-coding-guidelines-for-unmanaged-code.md)。</span><span class="sxs-lookup"><span data-stu-id="50d82-222">For more information, see [Secure Coding Guidelines for Unmanaged Code](../../../framework/security/secure-coding-guidelines-for-unmanaged-code.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="50d82-223">示例</span><span class="sxs-lookup"><span data-stu-id="50d82-223">Example</span></span>  
 <span data-ttu-id="50d82-224">下面的示例声明的外部引用`Function`返回当前的用户名称的过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-224">The following example declares an external reference to a `Function` procedure that returns the current user name.</span></span> <span data-ttu-id="50d82-225">然后，它调用外部过程`GetUserNameA`作为的一部分`getUser`过程。</span><span class="sxs-lookup"><span data-stu-id="50d82-225">It then calls the external procedure `GetUserNameA` as part of the `getUser` procedure.</span></span>  
  
 [!code-vb[VbVbalrStatements#15](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/declare-statement_1.vb)]  
  
## <a name="example"></a><span data-ttu-id="50d82-226">示例</span><span class="sxs-lookup"><span data-stu-id="50d82-226">Example</span></span>  
 <span data-ttu-id="50d82-227"><xref:System.Runtime.InteropServices.DllImportAttribute>提供的替代方式的非托管代码中使用函数。</span><span class="sxs-lookup"><span data-stu-id="50d82-227">The <xref:System.Runtime.InteropServices.DllImportAttribute> provides an alternative way of using functions in unmanaged code.</span></span> <span data-ttu-id="50d82-228">下面的示例声明一个导入的函数而无需使用`Declare`语句。</span><span class="sxs-lookup"><span data-stu-id="50d82-228">The following example declares an imported function without using a `Declare` statement.</span></span>  
  
 [!code-vb[VbVbalrStatements#16](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/declare-statement_2.vb)]  
  
 [!code-vb[VbVbalrStatements#1](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/declare-statement_3.vb)]  
  
## <a name="see-also"></a><span data-ttu-id="50d82-229">另请参阅</span><span class="sxs-lookup"><span data-stu-id="50d82-229">See Also</span></span>  
 <xref:Microsoft.VisualBasic.ErrObject.LastDllError%2A>  
 [<span data-ttu-id="50d82-230">Imports 语句（.NET 命名空间和类型）</span><span class="sxs-lookup"><span data-stu-id="50d82-230">Imports Statement (.NET Namespace and Type)</span></span>](../../../visual-basic/language-reference/statements/imports-statement-net-namespace-and-type.md)  
 [<span data-ttu-id="50d82-231">AddressOf 运算符</span><span class="sxs-lookup"><span data-stu-id="50d82-231">AddressOf Operator</span></span>](../../../visual-basic/language-reference/operators/addressof-operator.md)  
 [<span data-ttu-id="50d82-232">Function 语句</span><span class="sxs-lookup"><span data-stu-id="50d82-232">Function Statement</span></span>](../../../visual-basic/language-reference/statements/function-statement.md)  
 [<span data-ttu-id="50d82-233">Sub 语句</span><span class="sxs-lookup"><span data-stu-id="50d82-233">Sub Statement</span></span>](../../../visual-basic/language-reference/statements/sub-statement.md)  
 [<span data-ttu-id="50d82-234">参数列表</span><span class="sxs-lookup"><span data-stu-id="50d82-234">Parameter List</span></span>](../../../visual-basic/language-reference/statements/parameter-list.md)  
 [<span data-ttu-id="50d82-235">Call 语句</span><span class="sxs-lookup"><span data-stu-id="50d82-235">Call Statement</span></span>](../../../visual-basic/language-reference/statements/call-statement.md)  
 [<span data-ttu-id="50d82-236">演练：调用 Windows API</span><span class="sxs-lookup"><span data-stu-id="50d82-236">Walkthrough: Calling Windows APIs</span></span>](../../../visual-basic/programming-guide/com-interop/walkthrough-calling-windows-apis.md)
