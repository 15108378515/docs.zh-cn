---
title: "每个...下一条语句 (Visual Basic 中) |Microsoft 文档"
ms.date: 2015-07-20
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-visual-basic
ms.topic: article
f1_keywords:
- vb.ForEach
- vb.ForEachNext
- vb.Each
- ForEachNext
dev_langs:
- VB
helpviewer_keywords:
- infinite loops
- Next statement, For Each...Next
- endless loops
- loop structures, For Each...Next
- loops, endless
- Each keyword
- instructions, repeating
- For Each statement
- collections, instruction repetition
- loops, infinite
- For Each...Next statements
- For keyword [Visual Basic], For Each...Next statements
- Exit statement, For Each...Next statements
- iteration
ms.assetid: ebce3120-95c3-42b1-b70b-fa7da40c75e2
caps.latest.revision: 56
author: stevehoag
ms.author: shoag
translation.priority.ht:
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- ru-ru
- zh-cn
- zh-tw
translation.priority.mt:
- cs-cz
- pl-pl
- pt-br
- tr-tr
ms.translationtype: Machine Translation
ms.sourcegitcommit: a06bd2a17f1d6c7308fa6337c866c1ca2e7281c0
ms.openlocfilehash: e0173877fa4a57da76fd774d70ce63d2beda23ad
ms.contentlocale: zh-cn
ms.lasthandoff: 03/13/2017

---
# <a name="for-eachnext-statement-visual-basic"></a><span data-ttu-id="6be52-102">For Each...Next 语句 (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="6be52-102">For Each...Next Statement (Visual Basic)</span></span>
<span data-ttu-id="6be52-103">集合中每个元素重复一的组语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-103">Repeats a group of statements for each element in a collection.</span></span>  
  
## <a name="syntax"></a><span data-ttu-id="6be52-104">语法</span><span class="sxs-lookup"><span data-stu-id="6be52-104">Syntax</span></span>  
  
```  
For Each element [ As datatype ] In group  
    [ statements ]  
    [ Continue For ]  
    [ statements ]  
    [ Exit For ]  
    [ statements ]  
Next [ element ]  
```  
  
## <a name="parts"></a><span data-ttu-id="6be52-105">部件</span><span class="sxs-lookup"><span data-stu-id="6be52-105">Parts</span></span>  
  
|<span data-ttu-id="6be52-106">术语</span><span class="sxs-lookup"><span data-stu-id="6be52-106">Term</span></span>|<span data-ttu-id="6be52-107">定义</span><span class="sxs-lookup"><span data-stu-id="6be52-107">Definition</span></span>|  
|---|---|  
|`element`|<span data-ttu-id="6be52-108">在所需`For Each`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-108">Required in the `For Each` statement.</span></span> <span data-ttu-id="6be52-109">参数是可选的`Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-109">Optional in the `Next` statement.</span></span> <span data-ttu-id="6be52-110">变量。</span><span class="sxs-lookup"><span data-stu-id="6be52-110">Variable.</span></span> <span data-ttu-id="6be52-111">用于循环访问集合的元素。</span><span class="sxs-lookup"><span data-stu-id="6be52-111">Used to iterate through the elements of the collection.</span></span>|  
|`datatype`|<span data-ttu-id="6be52-112">如果使用`element`不已声明。</span><span class="sxs-lookup"><span data-stu-id="6be52-112">Required if `element` isn't already declared.</span></span> <span data-ttu-id="6be52-113">数据类型的`element`。</span><span class="sxs-lookup"><span data-stu-id="6be52-113">Data type of `element`.</span></span>|  
|`group`|<span data-ttu-id="6be52-114">必需。</span><span class="sxs-lookup"><span data-stu-id="6be52-114">Required.</span></span> <span data-ttu-id="6be52-115">是集合类型或对象类型的变量。</span><span class="sxs-lookup"><span data-stu-id="6be52-115">A variable with a type that's a collection type or Object.</span></span> <span data-ttu-id="6be52-116">引用的集合对其`statements`要重复。</span><span class="sxs-lookup"><span data-stu-id="6be52-116">Refers to the collection over which the `statements` are to be repeated.</span></span>|  
|`statements`|<span data-ttu-id="6be52-117">可选。</span><span class="sxs-lookup"><span data-stu-id="6be52-117">Optional.</span></span> <span data-ttu-id="6be52-118">之间的一个或多个语句`For Each`和`Next`中每一项上运行`group`。</span><span class="sxs-lookup"><span data-stu-id="6be52-118">One or more statements between `For Each` and `Next` that run on each item in `group`.</span></span>|  
|`Continue For`|<span data-ttu-id="6be52-119">可选。</span><span class="sxs-lookup"><span data-stu-id="6be52-119">Optional.</span></span> <span data-ttu-id="6be52-120">将控制转移到的起始位置`For Each`循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-120">Transfers control to the start of the `For Each` loop.</span></span>|  
|`Exit For`|<span data-ttu-id="6be52-121">可选。</span><span class="sxs-lookup"><span data-stu-id="6be52-121">Optional.</span></span> <span data-ttu-id="6be52-122">传输控件外的`For Each`循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-122">Transfers control out of the `For Each` loop.</span></span>|  
|`Next`|<span data-ttu-id="6be52-123">必需。</span><span class="sxs-lookup"><span data-stu-id="6be52-123">Required.</span></span> <span data-ttu-id="6be52-124">终止的定义`For Each`循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-124">Terminates the definition of the `For Each` loop.</span></span>|  
  
## <a name="simple-example"></a><span data-ttu-id="6be52-125">简单的示例</span><span class="sxs-lookup"><span data-stu-id="6be52-125">Simple Example</span></span>  
 <span data-ttu-id="6be52-126">Use a `For Each`...`Next`循环时想要为集合或数组的每个元素重复的一组语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-126">Use a `For Each`...`Next` loop when you want to repeat a set of statements for each element of a collection or array.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="6be52-127">A [For...下一条语句](../../../visual-basic/language-reference/statements/for-next-statement.md)正常时，您可以将每个循环迭代与控制变量相关联，并确定该变量的初始值和最终值。</span><span class="sxs-lookup"><span data-stu-id="6be52-127">A [For...Next Statement](../../../visual-basic/language-reference/statements/for-next-statement.md) works well when you can associate each iteration of a loop with a control variable and determine that variable's initial and final values.</span></span> <span data-ttu-id="6be52-128">但是，当您正在同一个集合，初始和最终值的概念没有意义，并且您不必知道集合中存在的元素数量。</span><span class="sxs-lookup"><span data-stu-id="6be52-128">However, when you are dealing with a collection, the concept of initial and final values isn't meaningful, and you don't necessarily know how many elements the collection has.</span></span> <span data-ttu-id="6be52-129">在这种情况下， `For Each`...`Next`循环通常是更好的选择。</span><span class="sxs-lookup"><span data-stu-id="6be52-129">In this kind of case, a `For Each`...`Next` loop is often a better choice.</span></span>  
  
 <span data-ttu-id="6be52-130">在下面的示例中， `For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="6be52-130">In the following example, the `For Each`…`Next`</span></span> <span data-ttu-id="6be52-131">语句循环访问列表集合中的所有元素。</span><span class="sxs-lookup"><span data-stu-id="6be52-131">statement iterates through all the elements of a List collection.</span></span>  
  
 <span data-ttu-id="6be52-132">[!code-vb[VbVbalrStatements #&121;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_1.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-132">[!code-vb[VbVbalrStatements#121](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_1.vb)]</span></span>  
  
 <span data-ttu-id="6be52-133">有关更多示例，请参阅[集合](http://msdn.microsoft.com/library/e76533a9-5033-4a0b-b003-9c2be60d185b)和[数组](../../../visual-basic/programming-guide/language-features/arrays/index.md)。</span><span class="sxs-lookup"><span data-stu-id="6be52-133">For more examples, see [Collections](http://msdn.microsoft.com/library/e76533a9-5033-4a0b-b003-9c2be60d185b) and [Arrays](../../../visual-basic/programming-guide/language-features/arrays/index.md).</span></span>  
  
## <a name="nested-loops"></a><span data-ttu-id="6be52-134">嵌套的循环</span><span class="sxs-lookup"><span data-stu-id="6be52-134">Nested Loops</span></span>  
 <span data-ttu-id="6be52-135">您可以嵌套`For Each`通过将另一个循环内的循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-135">You can nest `For Each` loops by putting one loop within another.</span></span>  
  
 <span data-ttu-id="6be52-136">下面的示例演示嵌套`For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="6be52-136">The following example demonstrates nested `For Each`…`Next`</span></span> <span data-ttu-id="6be52-137">结构表示。</span><span class="sxs-lookup"><span data-stu-id="6be52-137">structures.</span></span>  
  
 <span data-ttu-id="6be52-138">[!code-vb[VbVbalrStatements #&122;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_2.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-138">[!code-vb[VbVbalrStatements#122](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_2.vb)]</span></span>  
  
 <span data-ttu-id="6be52-139">每次循环时，则此嵌套循环必须具有一个唯一`element`变量。</span><span class="sxs-lookup"><span data-stu-id="6be52-139">When you nest loops, each loop must have a unique `element` variable.</span></span>  
  
 <span data-ttu-id="6be52-140">此外可以嵌套不同类型的彼此内部控制结构。</span><span class="sxs-lookup"><span data-stu-id="6be52-140">You can also nest different kinds of control structures within each other.</span></span> <span data-ttu-id="6be52-141">有关详细信息，请参阅[嵌套的控制结构](../../../visual-basic/programming-guide/language-features/control-flow/nested-control-structures.md)。</span><span class="sxs-lookup"><span data-stu-id="6be52-141">For more information, see [Nested Control Structures](../../../visual-basic/programming-guide/language-features/control-flow/nested-control-structures.md).</span></span>  
  
## <a name="exit-for-and-continue-for"></a><span data-ttu-id="6be52-142">有关退出并继续</span><span class="sxs-lookup"><span data-stu-id="6be52-142">Exit For and Continue For</span></span>  
 <span data-ttu-id="6be52-143">[Exit For](../../../visual-basic/language-reference/statements/exit-statement.md)语句会导致执行退出`For`...`Next`</span><span class="sxs-lookup"><span data-stu-id="6be52-143">The [Exit For](../../../visual-basic/language-reference/statements/exit-statement.md) statement causes execution to exit the `For`…`Next`</span></span> <span data-ttu-id="6be52-144">为后面的语句的循环，并将控制权`Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-144">loop and transfers control to the statement that follows the `Next` statement.</span></span>  
  
 <span data-ttu-id="6be52-145">`Continue For`语句将控制权立即到循环的下一个迭代。</span><span class="sxs-lookup"><span data-stu-id="6be52-145">The `Continue For` statement transfers control immediately to the next iteration of the loop.</span></span> <span data-ttu-id="6be52-146">有关详细信息，请参阅[继续语句](../../../visual-basic/language-reference/statements/continue-statement.md)。</span><span class="sxs-lookup"><span data-stu-id="6be52-146">For more information, see [Continue Statement](../../../visual-basic/language-reference/statements/continue-statement.md).</span></span>  
  
 <span data-ttu-id="6be52-147">下面的示例演示如何使用`Continue For`和`Exit For`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-147">The following example shows how to use the `Continue For` and `Exit For` statements.</span></span>  
  
 <span data-ttu-id="6be52-148">[!code-vb[VbVbalrStatements #&123;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_3.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-148">[!code-vb[VbVbalrStatements#123](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_3.vb)]</span></span>  
  
 <span data-ttu-id="6be52-149">你可以放置任意数量的`Exit For`中的语句`For Each`循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-149">You can put any number of `Exit For` statements in a `For Each` loop.</span></span> <span data-ttu-id="6be52-150">当使用内嵌套`For Each`循环，`Exit For`会导致执行到下一个较高级别的嵌套退出最里面的循环，并将控制权。</span><span class="sxs-lookup"><span data-stu-id="6be52-150">When used within nested `For Each` loops, `Exit For` causes execution to exit the innermost loop and transfers control to the next higher level of nesting.</span></span>  
  
 <span data-ttu-id="6be52-151">`Exit For`通常在某些条件的评估后使用，因为在`If`...`Then`...`Else`结构。</span><span class="sxs-lookup"><span data-stu-id="6be52-151">`Exit For` is often used after an evaluation of some condition, for example, in an `If`...`Then`...`Else` structure.</span></span> <span data-ttu-id="6be52-152">您可能想要使用`Exit For`针对下列条件︰</span><span class="sxs-lookup"><span data-stu-id="6be52-152">You might want to use `Exit For` for the following conditions:</span></span>  
  
-   <span data-ttu-id="6be52-153">继续循环不必要或不可能。</span><span class="sxs-lookup"><span data-stu-id="6be52-153">Continuing to iterate is unnecessary or impossible.</span></span> <span data-ttu-id="6be52-154">这可能引起错误的值或终止请求。</span><span class="sxs-lookup"><span data-stu-id="6be52-154">This might be caused by an erroneous value or a termination request.</span></span>  
  
-   <span data-ttu-id="6be52-155">中捕获到异常`Try`...`Catch`...`Finally`.</span><span class="sxs-lookup"><span data-stu-id="6be52-155">An exception is caught in a `Try`...`Catch`...`Finally`.</span></span> <span data-ttu-id="6be52-156">您可以使用`Exit For`末尾`Finally`块。</span><span class="sxs-lookup"><span data-stu-id="6be52-156">You might use `Exit For` at the end of the `Finally` block.</span></span>  
  
-   <span data-ttu-id="6be52-157">存在无限循环，这是一个循环，无法运行大型或甚至无限数量的次数。</span><span class="sxs-lookup"><span data-stu-id="6be52-157">There an endless loop, which is a loop that could run a large or even infinite number of times.</span></span> <span data-ttu-id="6be52-158">如果检测到此类情况，则可以使用`Exit For`来退出循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-158">If you detect such a condition, you can use `Exit For` to escape the loop.</span></span> <span data-ttu-id="6be52-159">有关详细信息，请参阅[做...循环语句](../../../visual-basic/language-reference/statements/do-loop-statement.md)。</span><span class="sxs-lookup"><span data-stu-id="6be52-159">For more information, see [Do...Loop Statement](../../../visual-basic/language-reference/statements/do-loop-statement.md).</span></span>  
  
## <a name="iterators"></a><span data-ttu-id="6be52-160">迭代器</span><span class="sxs-lookup"><span data-stu-id="6be52-160">Iterators</span></span>  
 <span data-ttu-id="6be52-161">您使用*迭代器*要在集合上执行自定义的迭代。</span><span class="sxs-lookup"><span data-stu-id="6be52-161">You use an *iterator* to perform a custom iteration over a collection.</span></span> <span data-ttu-id="6be52-162">一个迭代器，可以是函数或`Get`取值函数。</span><span class="sxs-lookup"><span data-stu-id="6be52-162">An iterator can be a function or a `Get` accessor.</span></span> <span data-ttu-id="6be52-163">它使用`Yield`语句可返回一次该集合的每个元素。</span><span class="sxs-lookup"><span data-stu-id="6be52-163">It uses a `Yield` statement to return each element of the collection one at a time.</span></span>  
  
 <span data-ttu-id="6be52-164">通过使用调用迭代器`For Each...Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-164">You call an iterator by using a `For Each...Next` statement.</span></span> <span data-ttu-id="6be52-165">每次迭代`For Each`循环就会调用迭代器。</span><span class="sxs-lookup"><span data-stu-id="6be52-165">Each iteration of the `For Each` loop calls the iterator.</span></span> <span data-ttu-id="6be52-166">当`Yield`中迭代器中的表达式到达语句`Yield`返回语句，且不保留代码中的当前位置。</span><span class="sxs-lookup"><span data-stu-id="6be52-166">When a `Yield` statement is reached in the iterator, the expression in the `Yield` statement is returned, and the current location in code is retained.</span></span> <span data-ttu-id="6be52-167">下次调用迭代器时，将从该位置重新开始执行。</span><span class="sxs-lookup"><span data-stu-id="6be52-167">Execution is restarted from that location the next time that the iterator is called.</span></span>  
  
 <span data-ttu-id="6be52-168">下面的示例使用迭代器函数。</span><span class="sxs-lookup"><span data-stu-id="6be52-168">The following example uses an iterator function.</span></span> <span data-ttu-id="6be52-169">迭代器函数具有`Yield`内的语句[为...下一步](../../../visual-basic/language-reference/statements/for-next-statement.md)循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-169">The iterator function has a `Yield` statement that's inside a [For…Next](../../../visual-basic/language-reference/statements/for-next-statement.md) loop.</span></span> <span data-ttu-id="6be52-170">在`ListEvenNumbers`方法时，每次迭代`For Each`语句体创建了迭代器函数，它将继续到下一个调用`Yield`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-170">In the `ListEvenNumbers` method, each iteration of the `For Each` statement body creates a call to the iterator function, which proceeds to the next `Yield` statement.</span></span>  
  
 <span data-ttu-id="6be52-171">[!code-vb[VbVbalrStatements #&127;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-171">[!code-vb[VbVbalrStatements#127](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_4.vb)]</span></span>  
  
 <span data-ttu-id="6be52-172">有关详细信息，请参阅[迭代器](http://msdn.microsoft.com/library/f45331db-d595-46ec-9142-551d3d1eb1a7)， [Yield 语句](../../../visual-basic/language-reference/statements/yield-statement.md)，和[迭代器](../../../visual-basic/language-reference/modifiers/iterator.md)。</span><span class="sxs-lookup"><span data-stu-id="6be52-172">For more information, see [Iterators](http://msdn.microsoft.com/library/f45331db-d595-46ec-9142-551d3d1eb1a7), [Yield Statement](../../../visual-basic/language-reference/statements/yield-statement.md), and [Iterator](../../../visual-basic/language-reference/modifiers/iterator.md).</span></span>  
  
## <a name="technical-implementation"></a><span data-ttu-id="6be52-173">技术实现</span><span class="sxs-lookup"><span data-stu-id="6be52-173">Technical Implementation</span></span>  
 <span data-ttu-id="6be52-174">当`For Each`...`Next`</span><span class="sxs-lookup"><span data-stu-id="6be52-174">When a `For Each`…`Next`</span></span> <span data-ttu-id="6be52-175">运行语句时，Visual Basic 集合只有一次，在循环开始之前进行评估。</span><span class="sxs-lookup"><span data-stu-id="6be52-175">statement runs, Visual Basic evaluates the collection only one time, before the loop starts.</span></span> <span data-ttu-id="6be52-176">如果更改了语句块`element`或`group`，这些更改不会影响循环的迭代。</span><span class="sxs-lookup"><span data-stu-id="6be52-176">If your statement block changes `element` or `group`, these changes don't affect the iteration of the loop.</span></span>  
  
 <span data-ttu-id="6be52-177">当在集合中的所有元素已连续都分配给`element`、`For Each`循环停止并将控制权传递到后面的语句`Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-177">When all the elements in the collection have been successively assigned to `element`, the `For Each` loop stops and control passes to the statement following the `Next` statement.</span></span>  
  
 <span data-ttu-id="6be52-178">如果`element`尚未被外部声明该循环中，您必须将其声明中`For Each`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-178">If `element` hasn't been declared outside this loop, you must declare it in the `For Each` statement.</span></span> <span data-ttu-id="6be52-179">您可以声明的类型`element`使用由显式`As`语句，或者您可以依赖类型推断为指定类型。</span><span class="sxs-lookup"><span data-stu-id="6be52-179">You can declare the type of `element` explicitly by using an `As` statement, or you can rely on type inference to assign the type.</span></span> <span data-ttu-id="6be52-180">在任一情况下，范围`element`是循环的正文。</span><span class="sxs-lookup"><span data-stu-id="6be52-180">In either case, the scope of `element` is the body of the loop.</span></span> <span data-ttu-id="6be52-181">但是，不能声明`element`循环内外。</span><span class="sxs-lookup"><span data-stu-id="6be52-181">However, you cannot declare `element` both outside and inside the loop.</span></span>  
  
 <span data-ttu-id="6be52-182">您可以选择指定`element`中`Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-182">You can optionally specify `element` in the `Next` statement.</span></span> <span data-ttu-id="6be52-183">这可以提高您的程序的可读性，尤其是在具有嵌套`For Each`循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-183">This improves the readability of your program, especially if you have nested `For Each` loops.</span></span> <span data-ttu-id="6be52-184">你必须指定相同的变量作为出现在对应的那个`For Each`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-184">You must specify the same variable as the one that appears in the corresponding `For Each` statement.</span></span>  
  
 <span data-ttu-id="6be52-185">您可能想要避免更改的值`element`在一个循环内。</span><span class="sxs-lookup"><span data-stu-id="6be52-185">You might want to avoid changing the value of `element` inside a loop.</span></span> <span data-ttu-id="6be52-186">执行此操作可以导致更难以阅读和调试代码。</span><span class="sxs-lookup"><span data-stu-id="6be52-186">Doing this can make it more difficult to read and debug your code.</span></span> <span data-ttu-id="6be52-187">更改的值`group`不会影响该集合或它的元素，在第一次进入循环时已确定。</span><span class="sxs-lookup"><span data-stu-id="6be52-187">Changing the value of `group` doesn't affect the collection or its elements, which were determined when the loop was first entered.</span></span>  
  
 <span data-ttu-id="6be52-188">当在嵌套循环中，如果`Next`外部的嵌套级别语句遇到过`Next`作为内部级别的编译器会引发错误。</span><span class="sxs-lookup"><span data-stu-id="6be52-188">When you're nesting loops, if a `Next` statement of an outer nesting level is encountered before the `Next` of an inner level, the compiler signals an error.</span></span> <span data-ttu-id="6be52-189">但是，编译器可检测到这仅在您指定重叠错误`element`中每个`Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-189">However, the compiler can detect this overlapping error only if you specify `element` in every `Next` statement.</span></span>  
  
 <span data-ttu-id="6be52-190">如果您的代码依赖于遍历以特定的顺序集合`For Each`...`Next`循环不是最佳选择，除非您知道的枚举器对象的特征，否则该集合公开。</span><span class="sxs-lookup"><span data-stu-id="6be52-190">If your code depends on traversing a collection in a particular order, a `For Each`...`Next` loop isn't the best choice, unless you know the characteristics of the enumerator object the collection exposes.</span></span> <span data-ttu-id="6be52-191">遍历的顺序不由 Visual Basic 中，而是由确定<xref:System.Collections.IEnumerator.MoveNext%2A>的枚举数对象的方法。</xref:System.Collections.IEnumerator.MoveNext%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-191">The order of traversal isn't determined by Visual Basic, but by the <xref:System.Collections.IEnumerator.MoveNext%2A> method of the enumerator object.</span></span> <span data-ttu-id="6be52-192">因此，您可能无法预测集合中的哪个元素是在中返回的第一个`element`，或者它的下一个要返回给定元素的后面。</span><span class="sxs-lookup"><span data-stu-id="6be52-192">Therefore, you might not be able to predict which element of the collection is the first to be returned in `element`, or which is the next to be returned after a given element.</span></span> <span data-ttu-id="6be52-193">您可能会获得更可靠的结果使用其他循环结构，如`For`...`Next` or `Do`...`Loop`.</span><span class="sxs-lookup"><span data-stu-id="6be52-193">You might achieve more reliable results using a different loop structure, such as `For`...`Next` or `Do`...`Loop`.</span></span>  
  
 <span data-ttu-id="6be52-194">数据类型`element`这样的数据类型的元素必须是`group`可以转换为它。</span><span class="sxs-lookup"><span data-stu-id="6be52-194">The data type of `element` must be such that the data type of the elements of `group` can be converted to it.</span></span>  
  
 <span data-ttu-id="6be52-195">数据类型`group`必须是指的是集合或数组，它是可枚举的引用类型。</span><span class="sxs-lookup"><span data-stu-id="6be52-195">The data type of `group` must be a reference type that refers to a collection or an array that's enumerable.</span></span> <span data-ttu-id="6be52-196">通常这意味着`group`实现的对象是指<xref:System.Collections.IEnumerable>接口`System.Collections`命名空间或<xref:System.Collections.Generic.IEnumerable%601>接口`System.Collections.Generic`命名空间。</xref:System.Collections.Generic.IEnumerable%601> </xref:System.Collections.IEnumerable></span><span class="sxs-lookup"><span data-stu-id="6be52-196">Most commonly this means that `group` refers to an object that implements the <xref:System.Collections.IEnumerable> interface of the `System.Collections` namespace or the <xref:System.Collections.Generic.IEnumerable%601> interface of the `System.Collections.Generic` namespace.</span></span> <span data-ttu-id="6be52-197">`System.Collections.IEnumerable`定义<xref:System.Collections.IEnumerable.GetEnumerator%2A>方法，它返回集合的枚举器对象。</xref:System.Collections.IEnumerable.GetEnumerator%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-197">`System.Collections.IEnumerable` defines the <xref:System.Collections.IEnumerable.GetEnumerator%2A> method, which returns an enumerator object for the collection.</span></span> <span data-ttu-id="6be52-198">枚举数对象实现`System.Collections.IEnumerator`接口`System.Collections`命名空间，并公开<xref:System.Collections.IEnumerator.Current%2A>属性和<xref:System.Collections.IEnumerator.Reset%2A>和<xref:System.Collections.IEnumerator.MoveNext%2A>方法。</xref:System.Collections.IEnumerator.MoveNext%2A> </xref:System.Collections.IEnumerator.Reset%2A> </xref:System.Collections.IEnumerator.Current%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-198">The enumerator object implements the `System.Collections.IEnumerator` interface of the `System.Collections` namespace and exposes the <xref:System.Collections.IEnumerator.Current%2A> property and the <xref:System.Collections.IEnumerator.Reset%2A> and <xref:System.Collections.IEnumerator.MoveNext%2A> methods.</span></span> <span data-ttu-id="6be52-199">Visual Basic 使用这些来遍历该集合。</span><span class="sxs-lookup"><span data-stu-id="6be52-199">Visual Basic uses these to traverse the collection.</span></span>  
  
### <a name="narrowing-conversions"></a><span data-ttu-id="6be52-200">收缩转换</span><span class="sxs-lookup"><span data-stu-id="6be52-200">Narrowing Conversions</span></span>  
 <span data-ttu-id="6be52-201">当`Option Strict`设置为`On`，收缩转换通常会导致编译器错误。</span><span class="sxs-lookup"><span data-stu-id="6be52-201">When `Option Strict` is set to `On`, narrowing conversions ordinarily cause compiler errors.</span></span> <span data-ttu-id="6be52-202">在`For Each`语句，但是，从中的元素的转换`group`到`element`进行求值和在运行时执行收缩转换所致的编译器错误将被抑制。</span><span class="sxs-lookup"><span data-stu-id="6be52-202">In a `For Each` statement, however, conversions from the elements in `group` to `element` are evaluated and performed at run time, and compiler errors caused by narrowing conversions are suppressed.</span></span>  
  
 <span data-ttu-id="6be52-203">在下面的示例中，分配`m`的初始值为`n`时将不会编译`Option Strict`打开，因为转换`Long`到`Integer`是收缩转换。</span><span class="sxs-lookup"><span data-stu-id="6be52-203">In the following example, the assignment of `m` as the initial value for `n` doesn't compile when `Option Strict` is on because the conversion of a `Long` to an `Integer` is a narrowing conversion.</span></span> <span data-ttu-id="6be52-204">在`For Each`语句，但是，没有编译器错误是，即使报告分配给`number`要求从同一转换`Long`到`Integer`。</span><span class="sxs-lookup"><span data-stu-id="6be52-204">In the `For Each` statement, however, no compiler error is reported, even though the assignment to `number` requires the same conversion from `Long` to `Integer`.</span></span> <span data-ttu-id="6be52-205">在`For Each`语句中包含很多，运行时错误发生时<xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A>应用于较大的数字。</xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-205">In the `For Each` statement that contains a large number, a run-time error occurs when <xref:Microsoft.VisualBasic.CompilerServices.Conversions.ToInteger%2A> is applied to the large number.</span></span>  
  
 <span data-ttu-id="6be52-206">[!code-vb[VbVbalrStatements #&89;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_5.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-206">[!code-vb[VbVbalrStatements#89](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_5.vb)]</span></span>  
  
### <a name="ienumerator-calls"></a><span data-ttu-id="6be52-207">IEnumerator 调用</span><span class="sxs-lookup"><span data-stu-id="6be52-207">IEnumerator Calls</span></span>  
 <span data-ttu-id="6be52-208">当执行`For Each`...`Next`循环启动时，Visual Basic 验证`group`指的是有效的集合对象。</span><span class="sxs-lookup"><span data-stu-id="6be52-208">When execution of a `For Each`...`Next` loop starts, Visual Basic verifies that `group` refers to a valid collection object.</span></span> <span data-ttu-id="6be52-209">如果没有，则它引发异常。</span><span class="sxs-lookup"><span data-stu-id="6be52-209">If not, it throws an exception.</span></span> <span data-ttu-id="6be52-210">否则，它调用<xref:System.Collections.IEnumerator.MoveNext%2A>方法和<xref:System.Collections.IEnumerator.Current%2A>要返回的第一个元素的枚举数对象的属性。</xref:System.Collections.IEnumerator.Current%2A> </xref:System.Collections.IEnumerator.MoveNext%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-210">Otherwise, it calls the <xref:System.Collections.IEnumerator.MoveNext%2A> method and the <xref:System.Collections.IEnumerator.Current%2A> property of the enumerator object to return the first element.</span></span> <span data-ttu-id="6be52-211">如果`MoveNext`指示是否有没有下一个元素，即如果该集合为空，`For Each`循环停止并将控制权传递到后面的语句`Next`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-211">If `MoveNext` indicates that there is no next element, that is, if the collection is empty, the `For Each` loop stops and control passes to the statement following the `Next` statement.</span></span> <span data-ttu-id="6be52-212">否则，则 Visual Basic 设置`element`到第一个元素和运行此语句块。</span><span class="sxs-lookup"><span data-stu-id="6be52-212">Otherwise, Visual Basic sets `element` to the first element and runs the statement block.</span></span>  
  
 <span data-ttu-id="6be52-213">每次 Visual Basic 遇到`Next`语句，它返回到`For Each`语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-213">Each time Visual Basic encounters the `Next` statement, it returns to the `For Each` statement.</span></span> <span data-ttu-id="6be52-214">它将再次调用`MoveNext`和`Current`要返回的下一个元素，并再次运行块或停止根据结果的循环。</span><span class="sxs-lookup"><span data-stu-id="6be52-214">Again it calls `MoveNext` and `Current` to return the next element, and again it either runs the block or stops the loop depending on the result.</span></span> <span data-ttu-id="6be52-215">此过程将继续，直至`MoveNext`指示没有下一个元素或`Exit For`遇到语句。</span><span class="sxs-lookup"><span data-stu-id="6be52-215">This process continues until `MoveNext` indicates that there is no next element or an `Exit For` statement is encountered.</span></span>  
  
 <span data-ttu-id="6be52-216">**对集合进行修改。**</span><span class="sxs-lookup"><span data-stu-id="6be52-216">**Modifying the Collection.**</span></span> <span data-ttu-id="6be52-217">返回的枚举器对象<xref:System.Collections.IEnumerable.GetEnumerator%2A>通常不允许您通过添加、 删除、 替换或重新排列任何元素更改集合。</xref:System.Collections.IEnumerable.GetEnumerator%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-217">The enumerator object returned by <xref:System.Collections.IEnumerable.GetEnumerator%2A> normally doesn't let you change the collection by adding, deleting, replacing, or reordering any elements.</span></span> <span data-ttu-id="6be52-218">如果您已经启动后更改集合`For Each`...`Next`循环中，枚举器对象将变为无效，并访问的元素的下一步尝试导致<xref:System.InvalidOperationException>异常。</xref:System.InvalidOperationException></span><span class="sxs-lookup"><span data-stu-id="6be52-218">If you change the collection after you have initiated a `For Each`...`Next` loop, the enumerator object becomes invalid, and the next attempt to access an element causes an <xref:System.InvalidOperationException> exception.</span></span>  
  
 <span data-ttu-id="6be52-219">但是，修改此阻止不由[!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]，而是通过实现<xref:System.Collections.IEnumerable>接口。</xref:System.Collections.IEnumerable></span><span class="sxs-lookup"><span data-stu-id="6be52-219">However, this blocking of modification isn't determined by [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)], but rather by the implementation of the <xref:System.Collections.IEnumerable> interface.</span></span> <span data-ttu-id="6be52-220">它是可以实现`IEnumerable`允许在迭代期间修改的方式。</span><span class="sxs-lookup"><span data-stu-id="6be52-220">It is possible to implement `IEnumerable` in a way that allows for modification during iteration.</span></span> <span data-ttu-id="6be52-221">如果您正在考虑进行这种动态修改，请确保您了解的特征`IEnumerable`上正在使用的集合实现。</span><span class="sxs-lookup"><span data-stu-id="6be52-221">If you are considering doing such dynamic modification, make sure that you understand the characteristics of the `IEnumerable` implementation on the collection you are using.</span></span>  
  
 <span data-ttu-id="6be52-222">**修改集合元素。**</span><span class="sxs-lookup"><span data-stu-id="6be52-222">**Modifying Collection Elements.**</span></span> <span data-ttu-id="6be52-223"><xref:System.Collections.IEnumerator.Current%2A>枚举器对象的属性是[ReadOnly](../../../visual-basic/language-reference/modifiers/readonly.md)，并返回集合中的每个元素的本地副本。</xref:System.Collections.IEnumerator.Current%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-223">The <xref:System.Collections.IEnumerator.Current%2A> property of the enumerator object is [ReadOnly](../../../visual-basic/language-reference/modifiers/readonly.md), and it returns a local copy of each collection element.</span></span> <span data-ttu-id="6be52-224">这意味着您不能修改这些元素本身中`For Each`...`Next` loop.</span><span class="sxs-lookup"><span data-stu-id="6be52-224">This means that you cannot modify the elements themselves in a `For Each`...`Next` loop.</span></span> <span data-ttu-id="6be52-225">您所做的任何修改会影响中的本地副本`Current`而不反映回基础集合。</span><span class="sxs-lookup"><span data-stu-id="6be52-225">Any modification you make affects only the local copy from `Current` and isn't reflected back into the underlying collection.</span></span> <span data-ttu-id="6be52-226">但是，如果元素是引用类型，您可以修改它所指向的实例的成员。</span><span class="sxs-lookup"><span data-stu-id="6be52-226">However, if an element is a reference type, you can modify the members of the instance to which it points.</span></span> <span data-ttu-id="6be52-227">下面的示例修改`BackColor`的每个成员`thisControl`元素。</span><span class="sxs-lookup"><span data-stu-id="6be52-227">The following example modifies the `BackColor` member of each `thisControl` element.</span></span> <span data-ttu-id="6be52-228">但是，不能修改`thisControl`本身。</span><span class="sxs-lookup"><span data-stu-id="6be52-228">You cannot, however, modify `thisControl` itself.</span></span>  
  
<span data-ttu-id="6be52-229"><CodeContentPlaceHolder>1</CodeContentPlaceHolder></span><span class="sxs-lookup"><span data-stu-id="6be52-229"><CodeContentPlaceHolder>1</CodeContentPlaceHolder></span></span>  
 <span data-ttu-id="6be52-230">前面的示例可以修改`BackColor`的每个成员`thisControl`元素，但是不能修改`thisControl`本身。</span><span class="sxs-lookup"><span data-stu-id="6be52-230">The previous example can modify the `BackColor` member of each `thisControl` element, although it cannot modify `thisControl` itself.</span></span>  
  
 <span data-ttu-id="6be52-231">**遍历数组进行初始化。**</span><span class="sxs-lookup"><span data-stu-id="6be52-231">**Traversing Arrays.**</span></span> <span data-ttu-id="6be52-232">因为<xref:System.Array>类实现<xref:System.Collections.IEnumerable>接口，所有数组都公开<xref:System.Array.GetEnumerator%2A>方法。</xref:System.Array.GetEnumerator%2A> </xref:System.Collections.IEnumerable> </xref:System.Array></span><span class="sxs-lookup"><span data-stu-id="6be52-232">Because the <xref:System.Array> class implements the <xref:System.Collections.IEnumerable> interface, all arrays expose the <xref:System.Array.GetEnumerator%2A> method.</span></span> <span data-ttu-id="6be52-233">这意味着您可以循环访问数组`For Each`...`Next` loop.</span><span class="sxs-lookup"><span data-stu-id="6be52-233">This means that you can iterate through an array with a `For Each`...`Next` loop.</span></span> <span data-ttu-id="6be52-234">但是，只能读取数组元素。</span><span class="sxs-lookup"><span data-stu-id="6be52-234">However, you can only read the array elements.</span></span> <span data-ttu-id="6be52-235">你不能更改它们。</span><span class="sxs-lookup"><span data-stu-id="6be52-235">You cannot change them.</span></span>  
  
## <a name="example"></a><span data-ttu-id="6be52-236">示例</span><span class="sxs-lookup"><span data-stu-id="6be52-236">Example</span></span>  
 <span data-ttu-id="6be52-237">下面的示例列出在 C:\ 目录中的所有文件夹使用<xref:System.IO.DirectoryInfo>类。</xref:System.IO.DirectoryInfo></span><span class="sxs-lookup"><span data-stu-id="6be52-237">The following example lists all the folders in the C:\ directory by using the <xref:System.IO.DirectoryInfo> class.</span></span>  
  
 <span data-ttu-id="6be52-238">[!code-vb[VbVbalrStatements #&124;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_6.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-238">[!code-vb[VbVbalrStatements#124](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_6.vb)]</span></span>  
  
## <a name="example"></a><span data-ttu-id="6be52-239">示例</span><span class="sxs-lookup"><span data-stu-id="6be52-239">Example</span></span>  
 <span data-ttu-id="6be52-240">以下示例阐释了对集合排序的过程。</span><span class="sxs-lookup"><span data-stu-id="6be52-240">The following example illustrates a procedure for sorting a collection.</span></span> <span data-ttu-id="6be52-241">该示例进行排序的实例`Car` <xref:System.Collections.Generic.List%601>。</xref:System.Collections.Generic.List%601>中存储的类</span><span class="sxs-lookup"><span data-stu-id="6be52-241">The example sorts instances of a `Car` class that are stored in a <xref:System.Collections.Generic.List%601>.</span></span> <span data-ttu-id="6be52-242">`Car`类实现<xref:System.IComparable%601>接口，此操作需要<xref:System.IComparable%601.CompareTo%2A>方法来实现。</xref:System.IComparable%601.CompareTo%2A> </xref:System.IComparable%601></span><span class="sxs-lookup"><span data-stu-id="6be52-242">The `Car` class implements the <xref:System.IComparable%601> interface, which requires that the <xref:System.IComparable%601.CompareTo%2A> method be implemented.</span></span>  
  
 <span data-ttu-id="6be52-243">每次调用<xref:System.IComparable%601.CompareTo%2A>方法可用于排序的一个比较。</xref:System.IComparable%601.CompareTo%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-243">Each call to the <xref:System.IComparable%601.CompareTo%2A> method makes a single comparison that's used for sorting.</span></span> <span data-ttu-id="6be52-244">用户编写的代码中`CompareTo`方法返回当前对象与另一个对象的每个比较的值。</span><span class="sxs-lookup"><span data-stu-id="6be52-244">User-written code in the `CompareTo` method returns a value for each comparison of the current object with another object.</span></span> <span data-ttu-id="6be52-245">如果当前对象小于另一个对象，则返回的值小于零；如果当前对象大于另一个对象，则返回的值大于零；如果当前对象等于另一个对象，则返回的值等于零。</span><span class="sxs-lookup"><span data-stu-id="6be52-245">The value returned is less than zero if the current object is less than the other object, greater than zero if the current object is greater than the other object, and zero if they are equal.</span></span> <span data-ttu-id="6be52-246">这使你可以在代码中定义大于、小于和等于条件。</span><span class="sxs-lookup"><span data-stu-id="6be52-246">This enables you to define in code the criteria for greater than, less than, and equal.</span></span>  
  
 <span data-ttu-id="6be52-247">在`ListCars`方法，`cars.Sort()`语句对列表进行排序。</span><span class="sxs-lookup"><span data-stu-id="6be52-247">In the `ListCars` method, the `cars.Sort()` statement sorts the list.</span></span> <span data-ttu-id="6be52-248">此调用<xref:System.Collections.Generic.List%601.Sort%2A>方法<xref:System.Collections.Generic.List%601>导致`CompareTo`方法来对自动调用`Car`中的对象`List`。</xref:System.Collections.Generic.List%601> </xref:System.Collections.Generic.List%601.Sort%2A></span><span class="sxs-lookup"><span data-stu-id="6be52-248">This call to the <xref:System.Collections.Generic.List%601.Sort%2A> method of the <xref:System.Collections.Generic.List%601> causes the `CompareTo` method to be called automatically for the `Car` objects in the `List`.</span></span>  
  
 <span data-ttu-id="6be52-249">[!code-vb[VbVbalrStatements #&125;](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_7.vb)]</span><span class="sxs-lookup"><span data-stu-id="6be52-249">[!code-vb[VbVbalrStatements#125](../../../visual-basic/language-reference/error-messages/codesnippet/VisualBasic/for-each-next-statement_7.vb)]</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6be52-250">另请参阅</span><span class="sxs-lookup"><span data-stu-id="6be52-250">See Also</span></span>  
 <span data-ttu-id="6be52-251">[集合](http://msdn.microsoft.com/library/e76533a9-5033-4a0b-b003-9c2be60d185b) </span><span class="sxs-lookup"><span data-stu-id="6be52-251">[Collections](http://msdn.microsoft.com/library/e76533a9-5033-4a0b-b003-9c2be60d185b) </span></span>  
<span data-ttu-id="6be52-252"> [有关...下一条语句](../../../visual-basic/language-reference/statements/for-next-statement.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-252"> [For...Next Statement](../../../visual-basic/language-reference/statements/for-next-statement.md) </span></span>  
<span data-ttu-id="6be52-253"> [循环结构](../../../visual-basic/programming-guide/language-features/control-flow/loop-structures.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-253"> [Loop Structures](../../../visual-basic/programming-guide/language-features/control-flow/loop-structures.md) </span></span>  
<span data-ttu-id="6be52-254"> [While...While 语句结束](../../../visual-basic/language-reference/statements/while-end-while-statement.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-254"> [While...End While Statement](../../../visual-basic/language-reference/statements/while-end-while-statement.md) </span></span>  
<span data-ttu-id="6be52-255"> [执行操作...循环语句](../../../visual-basic/language-reference/statements/do-loop-statement.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-255"> [Do...Loop Statement](../../../visual-basic/language-reference/statements/do-loop-statement.md) </span></span>  
<span data-ttu-id="6be52-256"> [扩大转换和收缩转换](../../../visual-basic/programming-guide/language-features/data-types/widening-and-narrowing-conversions.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-256"> [Widening and Narrowing Conversions](../../../visual-basic/programming-guide/language-features/data-types/widening-and-narrowing-conversions.md) </span></span>  
<span data-ttu-id="6be52-257"> [对象初始值设定项︰ 命名类型和匿名类型](../../../visual-basic/programming-guide/language-features/objects-and-classes/object-initializers-named-and-anonymous-types.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-257"> [Object Initializers: Named and Anonymous Types](../../../visual-basic/programming-guide/language-features/objects-and-classes/object-initializers-named-and-anonymous-types.md) </span></span>  
<span data-ttu-id="6be52-258"> [集合初始值设定项](../../../visual-basic/programming-guide/language-features/collection-initializers/index.md) </span><span class="sxs-lookup"><span data-stu-id="6be52-258"> [Collection Initializers](../../../visual-basic/programming-guide/language-features/collection-initializers/index.md) </span></span>  
<span data-ttu-id="6be52-259"> [阵列](../../../visual-basic/programming-guide/language-features/arrays/index.md)</span><span class="sxs-lookup"><span data-stu-id="6be52-259"> [Arrays](../../../visual-basic/programming-guide/language-features/arrays/index.md)</span></span>
